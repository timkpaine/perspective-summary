const t=new WeakMap,e=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?5e6:1e7;function i(t,e,i,s,o){var l={};return Object.keys(s).forEach((function(t){l[t]=s[t]})),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=i.slice().reverse().reduce((function(i,s){return s(t,e,i)||i}),l),o&&void 0!==l.initializer&&(l.value=l.initializer?l.initializer.call(o):void 0,l.initializer=void 0),void 0===l.initializer&&(Object.defineProperty(t,e,l),l=null),l}let s=0,o=0,l=performance.now();const a=(t,...e)=>t.map((t,i)=>[t,e[i]]).flat().filter(t=>!!t).join("");function r(t,e,i){const s=i.value,o=Symbol("regular-table throttle lock");return i.value=async function(...t){if(void 0!==this[o]&&(await this[o],void 0!==this[o]))return void await this[o];let e;this[o]=(()=>{let t;const e=new Promise(e=>{t=e});return e.resolve=t,e})();try{e=await s.call(this,...t)}finally{const t=this[o];this[o]=void 0,t.resolve()}return e},i.value.flush=async function(){return await new Promise(requestAnimationFrame),await this[o]},i}var _;let n=(i((_=class extends HTMLElement{create_shadow_dom(){this.attachShadow({mode:"open"});this.shadowRoot.innerHTML=a` <style> ${":host{bottom:0;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch}:host,div.rt-virtual-panel{position:absolute;top:0;left:0;right:0}div.rt-virtual-panel{pointer-events:none}div.rt-scroll-table-clip{position:sticky;contain:strict;overflow-anchor:none;width:100%;height:100%}div.rt-tree-container{display:flex;align-items:center;height:100%}slot{position:absolute;overflow:hidden;overflow-anchor:none}"} </style> <style> ${":host ::slotted(table){--regular-table--transform-x:0px;--regular-table--transform-y:0px;--regular-table--clip-x:0px;--regular-table--clip-y:0px}"} </style> <div class="rt-virtual-panel"></div> <div class="rt-scroll-table-clip"> ${"<slot></slot>"} </div> `;const[,t,e,i]=this.shadowRoot.children;this._sub_cell_style=t,this._table_clip=i,this._virtual_panel=e,this._setup_virtual_scroll()}_setup_virtual_scroll(){this._table_clip&&("both"===this._virtual_mode||"vertical"===this._virtual_mode?this._table_clip.style.top="0px":this._table_clip.style.removeProperty("top"),"both"===this._virtual_mode||"horizontal"===this._virtual_mode?this._table_clip.style.left="0px":this._table_clip.style.removeProperty("left"),"both"!==this._virtual_mode?this._table_clip.style.contain="none":this._table_clip.style.removeProperty("contain"))}_calculate_viewport(t,e){const{start_row:i,end_row:s}=this._calculate_row_range(t),{start_col:o,end_col:l}=this._calculate_column_range(e);return this._nrows=t,{start_col:o,end_col:l,start_row:i,end_row:s}}_calculate_row_range(t){const{height:e}=this._container_size,i=this._column_sizes.row_height||19,s=this._view_cache.config.column_pivots.length,o=Math.max(1,this._virtual_panel.offsetHeight-this.clientHeight),l=Math.max(Math.ceil(this.scrollTop),0)/o,a=e/i-s,r=t||0,_=Math.max(0,Math.ceil(r-a))*l;return{start_row:_,end_row:Math.max(0,Math.min(_+a,t))}}_calc_start_column(){const t=this._view_cache.config.row_pivots.length;let e=0,i=0,s=0;for(;i<this.scrollLeft;){const o=this._column_sizes.indices[e+t];s=this.scrollLeft-i,e+=1,i+=void 0!==o?o:60}return e+=s/(this._column_sizes.indices[e+t-1]||60),Math.max(0,e-1)}_calculate_column_range(t){if("none"===this._virtual_mode||"vertical"===this._virtual_mode)return{start_col:0,end_col:1/0};{const e=this._calc_start_column();return{start_col:e,end_col:e+(this.table_model.num_columns()||Math.min(t,Math.ceil(this._container_size.width/60)))+1}}}_max_scroll_column(t){let e=0;if(this._view_cache.config.row_pivots.length>0)for(const t of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))e+=t;let i=this._view_cache.config.row_pivots.length,s=t;for(;e<this._container_size.width&&s>=0;)s--,e+=this._column_sizes.indices[s+i]||60;return Math.min(t-1,s+1)}_validate_viewport({start_col:t,end_col:e,start_row:i,end_row:s}){i=Math.floor(i),s=Math.ceil(s),t=Math.floor(t),e=Math.ceil(e);const o=this._start_col!==t,l=this._start_row!==i||this._end_row!==s||this._end_col!==e;return this._start_col=t,this._end_col=e,this._start_row=i,this._end_row=s,{invalid_column:o,invalid_row:l}}_calc_scrollable_column_width(t){let e=this._view_cache.config.row_pivots.length;const i=this._max_scroll_column(t);let s=e,o=0;for(;s<i+e;)o+=this._column_sizes.indices[s]||60,s++;return o}_update_virtual_panel_width(t,e){if(t)if("vertical"===this._virtual_mode||"none"===this._virtual_mode)this._virtual_panel.style.width=this._column_sizes.indices.reduce((t,e)=>t+e,0)+"px";else{const t=this._calc_scrollable_column_width(e);if(0!==t){const e=this._container_size.width+t+2;this._virtual_panel.style.width=e+"px"}else this._virtual_panel.style.width="1px"}}_update_virtual_panel_height(t){const{row_height:i=19}=this._column_sizes,s=this._view_cache.config.column_pivots.length*i;let o;if("horizontal"===this._virtual_mode||"none"===this._virtual_mode)o=t*i+s;else{const l=this.clientHeight/(this._table_clip.offsetHeight-s);o=Math.min(e,t*i*l)}this._virtual_panel.style.height=o+"px"}async draw(t={}){const e=performance.now(),{invalid_viewport:i=!0,preserve_width:l=!1}=t,{num_columns:a,num_rows:r}=await this._view_cache.view(0,0,0,0);this._container_size={width:"none"===this._virtual_mode||"vertical"===this._virtual_mode?1/0:this._table_clip.clientWidth,height:"none"===this._virtual_mode||"horizontal"===this._virtual_mode?1/0:this._table_clip.clientHeight},this._update_virtual_panel_height(r),l||this._update_virtual_panel_width(i,a);const _=this._calculate_viewport(r,a),{invalid_row:n,invalid_column:h}=this._validate_viewport(_);if(this._invalid_schema||n||h||i){let t=[],e=!0;for await(let i of this.table_model.draw(this._container_size,this._view_cache,this._selected_id,l,_,a)){void 0!==i&&(t=t.concat(i)),e&&(this.update_sub_cell_offset(_),e=!1),this._is_styling=!0;const s=this._style_callbacks;for(const t of s)await t({detail:this});if(this._is_styling=!1,!this._invalidated&&void 0!==i)break;this._invalidated=!1}this.table_model.autosize_cells(t),this.table_model.header.reset_header_cache(),l||this._update_virtual_panel_width(this._invalid_schema||h,a),this._invalid_schema=!1}else this.update_sub_cell_offset(_);var c;c=performance.now()-e,s=(s*o+c)/(o+1),o+=1}update_sub_cell_offset(t){var e;const i=this._column_sizes.row_height*(t.start_row%1)||0,s=this._column_sizes.indices[(this.table_model._row_headers_length||0)+Math.floor(t.start_col)]*(t.start_col%1)||0;let o=null===(e=this._sub_cell_style.sheet)||void 0===e?void 0:e.cssRules[0].style;o&&(o.setProperty("--regular-table--clip-x",s+"px"),o.setProperty("--regular-table--clip-y",i+"px"),o.setProperty("--regular-table--transform-x",`-${s}px`),o.setProperty("--regular-table--transform-y",`-${i}px`))}}).prototype,"draw",[r],Object.getOwnPropertyDescriptor(_.prototype,"draw"),_.prototype),_);var h;let c=(i((h=class extends n{register_listeners(){this.addEventListener("mousedown",this._on_click_or_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!0}),this._register_glitch_scroll_listeners()}_on_scroll(t){t.stopPropagation(),this.draw({invalid_viewport:!1})}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this))}_on_mousewheel(t){if(!window.safari)return;const{clientWidth:e,clientHeight:i,scrollTop:s,scrollLeft:o}=this;t.preventDefault(),t.returnValue=!1;const l=Math.max(1,this._virtual_panel.offsetHeight-i),a=Math.max(1,this._virtual_panel.offsetWidth-e);this.scrollTop=Math.max(0,Math.min(l,s+t.deltaY)),this.scrollLeft=Math.max(0,Math.min(a,o+t.deltaX)),this._on_scroll(t)}_on_touchmove(t){t.stopPropagation(),t.preventDefault(),t.returnValue=!1;const{clientWidth:e,clientHeight:i}=this,s=Math.max(1,this._virtual_panel.offsetHeight-i),o=Math.max(1,this._virtual_panel.offsetWidth-e);this.scrollTop=Math.min(s,this._memo_scroll_top+(this._memo_touch_startY-t.touches[0].pageY)),this.scrollLeft=Math.min(o,this._memo_scroll_left+(this._memo_touch_startX-t.touches[0].pageX)),this._on_scroll(t)}_on_touchstart(t){this._memo_touch_startY=t.touches[0].pageY,this._memo_touch_startX=t.touches[0].pageX,this._memo_scroll_top=this.scrollTop,this._memo_scroll_left=this.scrollLeft}async _on_dblclick(e){let i=e.target;for(;"TD"!==i.tagName&&"TH"!==i.tagName;)if(i=i.parentElement,!this.contains(i))return;const s=e.target.classList.contains("rt-column-resize"),o=t.get(i);if(s){e.stopImmediatePropagation(),i.style.minWidth="",i.style.maxWidth="",e.shiftKey?(this._column_sizes.override=[],this._column_sizes.auto=[],this._column_sizes.indices=[]):(this._column_sizes.override[o.size_key]=void 0,this._column_sizes.auto[o.size_key]=void 0,this._column_sizes.indices[o.size_key]=void 0);for(const t of e.shiftKey?[this.table_model.header.cells[this.table_model.header.cells.length-1],...this.table_model.body.cells]:this.table_model.body.cells)for(const i of e.shiftKey?t:[t[o._virtual_x]])i&&(i.style.minWidth="",i.style.maxWidth="",i.classList.remove("rt-cell-clip"));await this.draw()}}async _on_click(e){if(0!==e.button)return;let i=e.target;for(;"TD"!==i.tagName&&"TH"!==i.tagName;)if(i=i.parentElement,!this.contains(i))return;const s=e.target.classList.contains("rt-column-resize"),o=t.get(i);s&&(this._on_resize_column(e,i,o),e.stopImmediatePropagation())}async _on_click_or_dblclick(t){const e=performance.now();this._last_clicked_time&&e-this._last_clicked_time<500?(this._last_clicked_time=e,await this._on_dblclick(t)):(this._last_clicked_time=e,await this._on_click(t))}_on_resize_column(t,e,i){const{_virtual_x:s,size_key:o}=i,l=t.pageX,a=s+e.colSpan-1,r=this.table_model.header.get_column_header(a),_=this._column_sizes.indices[o],n=t=>this._on_resize_column_move(t,r,l,_,o,a),h=()=>{document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",h);const t=this._column_sizes.override[o],e=this._column_sizes.indices[o]!==t;this._column_sizes.indices[o]=t,e&&this.draw()};document.addEventListener("mousemove",n),document.addEventListener("mouseup",h)}async _on_resize_column_move(t,e,i,s,o,l){await new Promise(setTimeout);const a=t.pageX-i,r=Math.max(1,s+a);if(this._column_sizes.override[o]=r,a<0)await this.draw({preserve_width:!0});else{e.style.minWidth=r+"px",e.style.maxWidth=r+"px";const t=this._column_sizes.auto[o];for(const e of this.table_model.body.cells){const i=e[l];i&&(i.style.maxWidth=i.style.minWidth=r+"px",i.classList.toggle("rt-cell-clip",t>r))}}}}).prototype,"_on_resize_column_move",[r],Object.getOwnPropertyDescriptor(h.prototype,"_on_resize_column_move"),h.prototype),h);class d{constructor(t){this._name=t,this._elements=[],this._index=0}reset(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));const t=this._elements[this._index];return this._index+=1,t}}class u{constructor(t,e,i){this._column_sizes=t,this._container=e,this._span_factory=new d("span"),this.table=i,this.cells=[],this.rows=[]}num_columns(){return this._get_row(Math.max(0,this.rows.length-1)).row_container.length}num_rows(){return this.cells.length}_set_metadata(e,i){t.set(e,i)}_get_or_create_metadata(e){if(void 0===e)return{};if(t.has(e))return t.get(e);{const i={};return t.set(e,i),i}}_replace_cell(t,e){const{tr:i,row_container:s}=this._get_row(t);let o=s[e];return o&&(i.removeChild(o),s.splice(e,1,void 0)),o}_fetch_cell(t,e){if(t<0||e<0)return;const{row_container:i}=this._get_row(t);return i[e]}_get_cell(t="TD",e,i){const{tr:s,row_container:o}=this._get_row(e);let l=o[i];if(l||(i<o.length?(l=o[i]=document.createElement(t),s.insertBefore(l,o.slice(i+1).find(t=>t))):(l=o[i]=document.createElement(t),s.appendChild(l))),l.tagName!==t){const o=document.createElement(t);s.replaceChild(o,l),this.cells[e].splice(i,1,o),l=o}return l}_get_row(t){let e=this.rows[t];e||(e=this.rows[t]=document.createElement("tr"),this.table.appendChild(e));let i=this.cells[t];return i||(i=this.cells[t]=[]),{tr:e,row_container:i}}_clean_columns(t){for(let e=0;e<this.rows.length;e++){const i=this.rows[e],s=this.cells[e];this.cells[e]=s.slice(0,t[e]||t);const o=this.cells[e].filter(t=>void 0!==t).length;for(;i.children[o];)i.removeChild(i.children[o])}}_clean_rows(t){for(;this.table.children[t];)this.table.removeChild(this.table.children[t]);this.rows=this.rows.slice(0,t),this.cells=this.cells.slice(0,t)}}class m extends u{constructor(...t){super(...t),this._group_header_cache=[],this._offset_cache=[]}_draw_group_th(t,e,i){const s=this._get_cell("TH",e,t[e]||0);if(t[e]+=1,s.removeAttribute("colspan"),s.style.minWidth="0",s.textContent="",i instanceof HTMLElement)s.appendChild(i);else{const t=this._span_factory.get("span");t.textContent=i,s.appendChild(t)}const o=this._span_factory.get("span");return o.className="rt-column-resize",s.appendChild(o),s}_draw_group(t,e,i){const s=this._get_or_create_metadata(i);return s.column_header=t,s.value=e,s.value=e,s}_draw_th(t,e,i,s,o){const l=this._get_or_create_metadata(i);if(l.column_header=t,l.value=e,l.size_key=o.length?o[0]:o,!(o.length>1)){const t=this._column_sizes.override[l.size_key],e=this._column_sizes.auto[l.size_key];t?(i.classList.toggle("rt-cell-clip",e>t),i.style.minWidth=t+"px",i.style.maxWidth=t+"px"):e?(i.classList.remove("rt-cell-clip"),i.style.maxWidth="",i.style.minWidth=e+"px"):(i.style.maxWidth="",i.style.maxWidth="")}return l}get_column_header(t){return this._get_cell("TH",this.num_rows()-1,t)}draw(t,e,i,s,o,l,a){const r=null==e?void 0:e.length;if(0===r)return;let _,n,h;for(let m=0;m<r;m++){if(h=e[m]?e[m]:"",this._offset_cache[m]=this._offset_cache[m]||0,m<r-1){var c,d,u;(null===(c=this._group_header_cache)||void 0===c||null===(d=c[m])||void 0===d||null===(u=d[0])||void 0===u?void 0:u.value)===h?(_=this._group_header_cache[m][1],this._group_header_cache[m][2]+=1,1===i&&(this._group_header_cache[m][0].row_header_x=o),_.setAttribute("colspan",this._group_header_cache[m][2])):(_=this._draw_group_th(this._offset_cache,m,h),n=this._draw_group(e,h,_),this._group_header_cache[m]=[n,_,1])}else{_=this._draw_group_th(this._offset_cache,m,h),n=this._draw_th(t||e,h,_,s,o);for(const[t]of this._group_header_cache)t.size_key=n.size_key;_.removeAttribute("colspan")}_.classList.toggle("rt-group-corner",void 0===s),n&&(n.x=void 0===s?s:Math.floor(s),n.column_header_y=m,n.x0=Math.floor(l),n._virtual_x=a,1===i&&(n.row_header_x=o))}return this._clean_rows(this._offset_cache.length),{th:_,metadata:n}}clean(){this._clean_columns(this._offset_cache)}reset_header_cache(){this._offset_cache=[],this._group_header_cache=[]}}class v extends u{_draw_td(t,e,i,s,{column_name:o},{ridx_offset:l},a){const r=this._get_cell(t,e,s),_=this._get_or_create_metadata(r);_.y=e+Math.floor(l),_.size_key=a,"TD"===t&&(_.column_header=o);const n=this._column_sizes.override[_.size_key];if(n){const t=this._column_sizes.auto[_.size_key];r.classList.toggle("rt-cell-clip",t>n),r.style.minWidth=n+"px",r.style.maxWidth=n+"px"}else r.classList.remove("rt-cell-clip"),r.style.minWidth="",r.style.maxWidth="";return _.value!==i&&(i instanceof HTMLElement?(r.textContent="",r.appendChild(i)):r.textContent=i),_.value=i,{td:r,metadata:_}}draw(t,e,i,s=!1,o,l,a){const{cidx:r,column_data:_,row_headers:n,column_data_listener_metadata:h}=e;let c,{row_height:d}=i;const u=[],m=[];let v=0;const f=[];for(let w=0;w<(s?i.row_headers_length:1);w++){v=0;for(const g of _){var p;const _=null==n?void 0:n[v];let y;if(s){const t=g[w],s=this._fetch_cell(v-(u[w]||1),r+w),o=this._get_or_create_metadata(s),a=this._fetch_cell(v,r+w-(f[v]||1)),_=this._get_or_create_metadata(a);!a||_.value!==t&&void 0!==t||a.hasAttribute("rowspan")?s&&o.value===t&&!s.hasAttribute("colspan")?(u[w]=u[w]?u[w]+1:2,s.setAttribute("rowspan",u[w]),this._replace_cell(v,r+w)):(y=this._draw_td("TH",v,t,r+w,e,i,w),y.td.style.display="",y.td.removeAttribute("rowspan"),y.td.removeAttribute("colspan"),y.metadata.row_header=g,y.metadata.row_header_x=w,y.metadata.y0=Math.floor(i.ridx_offset),y.metadata.y1=Math.ceil(i.y1),y.metadata._virtual_x=w,void 0!==l&&(y.metadata.x0=Math.floor(l)),u[w]=1,f[v]=1,m[w]=y):(f[v]=f[v]?f[v]+1:2,a.setAttribute("colspan",f[v]),this._replace_cell(v,r+w))}else y=this._draw_td("TD",v,g,r,e,i,a),h&&(y.metadata.user=h[v]),y.metadata.x=void 0===o?o:Math.floor(o),y.metadata.x1=Math.ceil(i.x1),y.metadata.row_header=_||[],y.metadata.y0=Math.floor(i.ridx_offset),y.metadata.y1=Math.ceil(i.y1),y.metadata.dx=Math.floor(o-l),y.metadata.dy=y.metadata.y-Math.floor(y.metadata.y0),y.metadata._virtual_x=r,void 0!==l&&(y.metadata.x0=Math.floor(l)),m[0]=y;if(v++,c=y?y.metadata:c,d=d||(null===(p=y)||void 0===p?void 0:p.td.offsetHeight),v*d>t)break}}return this._clean_rows(v),{tds:m,ridx:v,metadata:c,row_height:d}}clean({ridx:t,cidx:e}){this._clean_rows(t),this._clean_columns(e)}}class f{constructor(t,e,i){this.clear(i);const[s]=i.children,[o,l]=s.children;this.table=s,this._column_sizes=e,this.header=new m(e,t,o),this.body=new v(e,t,l),this.fragment=document.createDocumentFragment()}num_columns(){return this.header.num_columns()}clear(t){t.innerHTML=a` <table cellspacing="0"> <thead></thead> <tbody></tbody> </table> `}autosize_cells(t){for(;t.length>0;){const[e,i,s]=t.pop();let o;const l=getComputedStyle(e);"border-box"!==l.boxSizing?(o=e.clientWidth,o-=l.paddingLeft?parseFloat(l.paddingLeft):0,o-=l.paddingRight?parseFloat(l.paddingRight):0):o=parseFloat(l.width),this._column_sizes.row_height=this._column_sizes.row_height||s.offsetHeight,this._column_sizes.indices[i.size_key]=o;const a=void 0!==this._column_sizes.override[i.size_key];o&&!a&&(this._column_sizes.auto[i.size_key]=o),"0px"===e.style.minWidth&&(e.style.minWidth=o+"px")}}async*draw(t,e,i,s,o,l){var a,r,_,n;const{width:h,height:c}=t,{view:d,config:u}=e;let{data:m,row_headers:v,column_headers:f,metadata:p}=await d(Math.floor(o.start_col),Math.floor(o.start_row),Math.ceil(o.end_col),Math.ceil(o.end_row));const{start_row:w=0,start_col:g=0,end_col:y=0,end_row:b=0}=o;v&&(this._row_headers_length=v.reduce((t,e)=>Math.max(t,e.length),0),v=v.map(t=>(t.length=this._row_headers_length,t))),e.config.column_pivots=Array.from(Array((null==f||null===(a=f[0])||void 0===a?void 0:a.length)||0).keys()),e.config.row_pivots=Array.from(Array((null===(r=v)||void 0===r||null===(_=r[0])||void 0===_?void 0:_.length)||0).keys());const x={viewport_width:0,selected_id:i,ridx_offset:w,sub_cell_offset:this._column_sizes.indices[(this._row_headers_length||0)+Math.floor(o.start_col)]||0,x0:g,x1:y,y1:b,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length};let z,M=0,k=[],L=!0;if((null===(n=v)||void 0===n?void 0:n.length)>0){const t=u.row_pivots.join(","),i={column_name:t,cidx:0,column_data:v,row_headers:v,first_col:L},o=M+Math.floor(g);z=this.body.draw(c,i,{...x,x0:0},!0,void 0,void 0,o);const l=[];for(let i=0;i<e.config.row_pivots.length;i++){const s=this.header.draw(t,Array(e.config.column_pivots.length).fill(""),1,void 0,i,g,i);s&&l.push(s)}if(L=!1,x.viewport_width+=l.reduce((t,{th:e},i)=>t+(this._column_sizes.indices[i]||e.offsetWidth),0),x.row_height=x.row_height||z.row_height,M=v[0].length,!s)for(let t=0;t<e.config.row_pivots.length;t++){const{td:e,metadata:i}=z.tds[t]||{},{th:s,metadata:o}=l[t]||{};(e||s)&&k.push([s||e,o||i,e||s])}}try{var W;let t=0;const e=l-o.start_col;for(;t<e;){if(!m[t]){let e=Math.max(o.end_col,0);o.start_col=e;let i=0,s=0;for(;this._column_sizes.indices.length>M+g+i+1&&s+x.viewport_width<h;)i++,s+=this._column_sizes.indices[M+g+i];if(s+x.viewport_width<h){const t=Math.min(l,e+5);o.end_col=Math.max(1,Math.min(l,t))}else o.end_col=Math.max(1,Math.min(l,e+i));const a=d(Math.floor(o.start_col),Math.floor(o.start_row),Math.ceil(o.end_col),Math.ceil(o.end_row));yield;const r=await a;if(0===r.data.length)return void(yield k);o.end_col=o.start_col+r.data.length;for(let e=0;e<r.data.length;e++){var T;if(m[t+e]=r.data[e],r.metadata&&(p[t+e]=r.metadata[e]),f)f[t+e]=null===(T=r.column_headers)||void 0===T?void 0:T[e]}}const e=(null==f?void 0:f[t])||"",i=m[t],a={column_name:e,cidx:M,column_data:i,column_data_listener_metadata:null==p?void 0:p[t],row_headers:v,first_col:L},r=t+g,_=M+Math.floor(g),n=this.header.draw(void 0,e,void 0,r,_,g,M);if(z=this.body.draw(c,a,x,!1,r,g,_),L=!1,!s)for(const{td:t,metadata:e}of z.tds)k.push([(null==n?void 0:n.th)||t,(null==n?void 0:n.metadata)||e,t||(null==n?void 0:n.th)]);const u=this._column_sizes.indices[M+Math.floor(g)];var H;if(u)x.viewport_width+=u;else x.viewport_width+=(null==n||null===(H=n.th)||void 0===H?void 0:H.offsetWidth)||z.tds.reduce((t,e)=>{var i;return t+(null===(i=e.td)||void 0===i?void 0:i.offsetWidth)},0);if(x.row_height=x.row_height||z.row_height,M++,t++,x.viewport_width-x.sub_cell_offset>h){var E;this.body.clean({ridx:(null===(E=z)||void 0===E?void 0:E.ridx)||0,cidx:M}),this.header.clean(),yield k,x.viewport_width=0;for(let[t]of k)x.viewport_width+=t.offsetWidth;if(x.viewport_width-x.sub_cell_offset>h)return}}this.body.clean({ridx:(null===(W=z)||void 0===W?void 0:W.ridx)||0,cidx:M}),this.header.clean(),yield k}finally{var A;this.body.clean({ridx:(null===(A=z)||void 0===A?void 0:A.ridx)||0,cidx:M}),this.header.clean(),this.body._span_factory.reset(),this.header._span_factory.reset()}}}const p=["both","horizontal","vertical","none"];class w extends c{constructor(){super(),this._column_sizes={auto:[],override:[],indices:[]},this._style_callbacks=[],this._initialized=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._initialized=!0,this.table_model=new f(this._table_clip,this._column_sizes,this))}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto=[],this._column_sizes.override=[],this._column_sizes.indices=[];for(let t=0;t<this.table_model.header.num_columns();t++){const e=this.table_model.header.get_column_header(t);e.style.minWidth="",e.style.maxWidth=""}}clear(){this.table_model=new f(this._table_clip,this._column_sizes,this)}addStyleListener(t){this._style_callbacks=this._style_callbacks.concat(t);let e=!0;return()=>{if(!e)return;e=!1;const i=this._style_callbacks=this._style_callbacks.slice(),s=i.indexOf(t);i.splice(s,1)}}invalidate(){if(!this._is_styling)throw new Error("Cannot call `invalidate()` outside of a `StyleListener`");this._invalidated=!0}getMeta(e){if(void 0!==e){if(e instanceof HTMLElement)return t.get(e);if(e.row_header_x>=0){if(e.row_header_x<this._view_cache.config.row_pivots.length){const t=this.table_model.body._fetch_cell(e.y,e.row_header_x);return this.getMeta(t)}}else{if(!(e.column_header_y>=0))return this.getMeta(this.table_model.body._fetch_cell(e.dy,e.dx+this.table_model._row_headers_length));if(e.column_header_y<this._view_cache.config.column_pivots.length){const t=this.table_model.body._fetch_cell(e.column_header_y,e.y);return this.getMeta(t)}}}}getDrawFPS(){return function(){const t=performance.now(),e=t-l,i=s,a=1e3*o/e,r=o;return s=0,o=0,l=t,{avg:i,real_fps:a,virtual_fps:1e3/i,num_frames:r,elapsed:e}}()}async scrollToCell(t,e){if(!this._view_cache)return void console.warn("data listener not configured");const i=this._column_sizes.row_height||19,s=this._view_cache.config.column_pivots.length*i,o=(this._table_clip.offsetHeight-s)%i;let l=(this._virtual_panel.offsetHeight-o)/this._nrows;this.scrollTop=Math.ceil(l*e);let a=0;for(;t>0;)t--,a+=this._column_sizes.indices[t+this._view_cache.config.row_pivots.length]||60;this.scrollLeft=Math.ceil(a),await new Promise(requestAnimationFrame),await this.draw.flush()}setDataListener(t,{virtual_mode:e="both"}={}){console.assert(p.indexOf(e)>-1,`Unknown virtual_mode ${e};  valid options are "both" (default), "horizontal", "vertical" or "none"`),this._virtual_mode=e,this._invalid_schema=!0,this._view_cache={view:t,config:{row_pivots:[],column_pivots:[]},schema:{}},this._setup_virtual_scroll()}__noop_jsdoc_hints(){}}document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",w);
//# sourceMappingURL=regular-table.js.map
