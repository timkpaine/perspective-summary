(()=>{var ks=Object.defineProperty;var js=(v,o)=>{for(var i in o)ks(v,i,{get:o[i],enumerable:!0})};var Ir={},Fs=(()=>{var v=Ir.url;return function(o){o=o||{};var i=typeof o<"u"?o:{},y,N;i.ready=new Promise(function(t,e){y=t,N=e});var x=Object.assign({},i),k=[],Y="./this.program",J=(t,e)=>{throw e},pe=!0,j=!1,ae="";function He(t){return i.locateFile?i.locateFile(t,ae):ae+t}var We,ct,Le,ze;(pe||j)&&(j?ae=self.location.href:typeof document<"u"&&document.currentScript&&(ae=document.currentScript.src),v&&(ae=v),ae.indexOf("blob:")!==0?ae=ae.substr(0,ae.replace(/[?#].*/,"").lastIndexOf("/")+1):ae="",We=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},j&&(Le=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),ct=(t,e,r)=>{var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=()=>{if(n.status==200||n.status==0&&n.response){e(n.response);return}r()},n.onerror=r,n.send(null)},ze=t=>document.title=t);var we=i.print||console.log.bind(console),D=i.printErr||console.warn.bind(console);Object.assign(i,x),x=null,i.arguments&&(k=i.arguments),i.thisProgram&&(Y=i.thisProgram),i.quit&&(J=i.quit);var ft=4,je=0,xt=t=>{je=t},se;i.wasmBinary&&(se=i.wasmBinary);var or=i.noExitRuntime||!0;typeof WebAssembly!="object"&&Ne("no native wasm support detected");var s,a=!1,f;function h(t,e){t||Ne(e)}var g=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function O(t,e,r){e>>>=0;for(var n=e+r,l=e;t[l]&&!(l>=n);)++l;if(l-e>16&&t.buffer&&g)return g.decode(t.subarray(e,l));for(var c="";e<l;){var _=t[e++];if(!(_&128)){c+=String.fromCharCode(_);continue}var u=t[e++]&63;if((_&224)==192){c+=String.fromCharCode((_&31)<<6|u);continue}var d=t[e++]&63;if((_&240)==224?_=(_&15)<<12|u<<6|d:_=(_&7)<<18|u<<12|d<<6|t[e++]&63,_<65536)c+=String.fromCharCode(_);else{var m=_-65536;c+=String.fromCharCode(55296|m>>10,56320|m&1023)}}return c}function P(t,e){return t>>>=0,t?O(H,t,e):""}function b(t,e,r,n){if(r>>>=0,!(n>0))return 0;for(var l=r,c=r+n-1,_=0;_<t.length;++_){var u=t.charCodeAt(_);if(u>=55296&&u<=57343){var d=t.charCodeAt(++_);u=65536+((u&1023)<<10)|d&1023}if(u<=127){if(r>=c)break;e[r++>>>0]=u}else if(u<=2047){if(r+1>=c)break;e[r++>>>0]=192|u>>6,e[r++>>>0]=128|u&63}else if(u<=65535){if(r+2>=c)break;e[r++>>>0]=224|u>>12,e[r++>>>0]=128|u>>6&63,e[r++>>>0]=128|u&63}else{if(r+3>=c)break;e[r++>>>0]=240|u>>18,e[r++>>>0]=128|u>>12&63,e[r++>>>0]=128|u>>6&63,e[r++>>>0]=128|u&63}}return e[r>>>0]=0,r-l}function M(t,e,r){return b(t,H,e,r)}function S(t){for(var e=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((n&1023)<<10)|t.charCodeAt(++r)&1023),n<=127?++e:n<=2047?e+=2:n<=65535?e+=3:e+=4}return e}var L=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function X(t,e){for(var r=t,n=r>>1,l=n+e/2;!(n>=l)&&re[n>>>0];)++n;if(r=n<<1,r-t>32&&L)return L.decode(H.subarray(t>>>0,r>>>0));for(var c="",_=0;!(_>=e/2);++_){var u=G[t+_*2>>>1];if(u==0)break;c+=String.fromCharCode(u)}return c}function Z(t,e,r){if(r===void 0&&(r=2147483647),r<2)return 0;r-=2;for(var n=e,l=r<t.length*2?r/2:t.length,c=0;c<l;++c){var _=t.charCodeAt(c);G[e>>>1]=_,e+=2}return G[e>>>1]=0,e-n}function ce(t){return t.length*2}function fe(t,e){for(var r=0,n="";!(r>=e/4);){var l=T[t+r*4>>>2];if(l==0)break;if(++r,l>=65536){var c=l-65536;n+=String.fromCharCode(55296|c>>10,56320|c&1023)}else n+=String.fromCharCode(l)}return n}function he(t,e,r){if(e>>>=0,r===void 0&&(r=2147483647),r<4)return 0;for(var n=e,l=n+r-4,c=0;c<t.length;++c){var _=t.charCodeAt(c);if(_>=55296&&_<=57343){var u=t.charCodeAt(++c);_=65536+((_&1023)<<10)|u&1023}if(T[e>>>2]=_,e+=4,e+4>l)break}return T[e>>>2]=0,e-n}function Fe(t){for(var e=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);n>=55296&&n<=57343&&++r,e+=4}return e}function Ye(t){var e=S(t)+1,r=ot(e);return r&&b(t,q,r,e),r}function kt(t,e){q.set(t,e>>>0)}function oe(t,e,r){for(var n=0;n<t.length;++n)q[e++>>>0]=t.charCodeAt(n);r||(q[e>>>0]=0)}var te,q,H,G,re,T,F,ie,$e;function Ge(t){te=t,i.HEAP8=q=new Int8Array(t),i.HEAP16=G=new Int16Array(t),i.HEAP32=T=new Int32Array(t),i.HEAPU8=H=new Uint8Array(t),i.HEAPU16=re=new Uint16Array(t),i.HEAPU32=F=new Uint32Array(t),i.HEAPF32=ie=new Float32Array(t),i.HEAPF64=$e=new Float64Array(t)}var Gs=i.INITIAL_MEMORY||16777216,ar,lr=[],ur=[],cr=[],Yr=!1;function Gr(){if(i.preRun)for(typeof i.preRun=="function"&&(i.preRun=[i.preRun]);i.preRun.length;)Jr(i.preRun.shift());Ft(lr)}function Br(){Yr=!0,Ft(ur)}function qr(){if(i.postRun)for(typeof i.postRun=="function"&&(i.postRun=[i.postRun]);i.postRun.length;)Zr(i.postRun.shift());Ft(cr)}function Jr(t){lr.unshift(t)}function Xr(t){ur.unshift(t)}function Zr(t){cr.unshift(t)}var Se=0,jt=null,Be=null;function Kr(t){Se++,i.monitorRunDependencies&&i.monitorRunDependencies(Se)}function Qr(t){if(Se--,i.monitorRunDependencies&&i.monitorRunDependencies(Se),Se==0&&(jt!==null&&(clearInterval(jt),jt=null),Be)){var e=Be;Be=null,e()}}function Ne(t){i.onAbort&&i.onAbort(t),t="Aborted("+t+")",D(t),a=!0,f=1,t+=". Build with -sASSERTIONS for more info.";var e=new WebAssembly.RuntimeError(t);throw N(e),e}var en="data:application/octet-stream;base64,";function fr(t){return t.startsWith(en)}var le;i.locateFile?(le="perspective.cpp.wasm",fr(le)||(le=He(le))):le=new URL("perspective.cpp.wasm",Ir.url).toString();function _r(t){try{if(t==le&&se)return new Uint8Array(se);if(Le)return Le(t);throw"both async and sync fetching of the wasm failed"}catch(e){Ne(e)}}function tn(){return!se&&(pe||j)&&typeof fetch=="function"?fetch(le,{credentials:"same-origin"}).then(function(t){if(!t.ok)throw"failed to load wasm binary file at '"+le+"'";return t.arrayBuffer()}).catch(function(){return _r(le)}):Promise.resolve().then(function(){return _r(le)})}function rn(){var t={a:_s};function e(_,u){var d=_.exports;i.asm=d,s=i.asm.qa,Ge(s.buffer),ar=i.asm.ua,Xr(i.asm.ra),Qr("wasm-instantiate")}Kr("wasm-instantiate");function r(_){e(_.instance)}function n(_){return tn().then(function(u){return WebAssembly.instantiate(u,t)}).then(function(u){return u}).then(_,function(u){D("failed to asynchronously prepare wasm: "+u),Ne(u)})}function l(){return!se&&typeof WebAssembly.instantiateStreaming=="function"&&!fr(le)&&typeof fetch=="function"?fetch(le,{credentials:"same-origin"}).then(function(_){var u=WebAssembly.instantiateStreaming(_,t);return u.then(r,function(d){return D("wasm streaming compile failed: "+d),D("falling back to ArrayBuffer instantiation"),n(r)})}):n(r)}if(i.instantiateWasm)try{var c=i.instantiateWasm(t,e);return c}catch(_){return D("Module.instantiateWasm callback failed with error: "+_),!1}return l().catch(N),{}}var nn={834836:t=>{throw new Error(P(t))}};function Ft(t){for(;t.length>0;){var e=t.shift();if(typeof e=="function"){e(i);continue}var r=e.func;typeof r=="number"?e.arg===void 0?dt(r)():dt(r)(e.arg):r(e.arg===void 0?null:e.arg)}}var _t=[];function dt(t){var e=_t[t];return e||(t>=_t.length&&(_t.length=t+1),_t[t]=e=ar.get(t)),e}function sn(t,e,r,n){Ne("Assertion failed: "+P(t)+", at: "+[e?P(e):"unknown filename",r,n?P(n):"unknown function"])}function on(t){return ot(t+24)+24}function an(t){this.excPtr=t,this.ptr=t-24,this.set_type=function(e){F[this.ptr+4>>>2]=e},this.get_type=function(){return F[this.ptr+4>>>2]},this.set_destructor=function(e){F[this.ptr+8>>>2]=e},this.get_destructor=function(){return F[this.ptr+8>>>2]},this.set_refcount=function(e){T[this.ptr>>>2]=e},this.set_caught=function(e){e=e?1:0,q[this.ptr+12>>>0]=e},this.get_caught=function(){return q[this.ptr+12>>>0]!=0},this.set_rethrown=function(e){e=e?1:0,q[this.ptr+13>>>0]=e},this.get_rethrown=function(){return q[this.ptr+13>>>0]!=0},this.init=function(e,r){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(r),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=T[this.ptr>>>2];T[this.ptr>>>2]=e+1},this.release_ref=function(){var e=T[this.ptr>>>2];return T[this.ptr>>>2]=e-1,e===1},this.set_adjusted_ptr=function(e){F[this.ptr+16>>>2]=e},this.get_adjusted_ptr=function(){return F[this.ptr+16>>>2]},this.get_exception_ptr=function(){var e=Fr(this.get_type());if(e)return F[this.excPtr>>>2];var r=this.get_adjusted_ptr();return r!==0?r:this.excPtr}}var ln=0,un=0;function cn(t,e,r){var n=new an(t);throw n.init(e,r),ln=t,un++,t}var qe={varargs:void 0,get:function(){qe.varargs+=4;var t=T[qe.varargs-4>>>2];return t},getStr:function(t){var e=P(t);return e}};function fn(t,e,r){return qe.varargs=r,0}function _n(t,e,r){}function dn(t,e,r){}function pn(t,e,r){return qe.varargs=r,0}function hn(t,e,r,n){qe.varargs=n}function mn(t,e){}function vn(t,e,r){}var pt={};function $t(t){for(;t.length;){var e=t.pop(),r=t.pop();r(e)}}function Je(t){return this.fromWireType(F[t>>>2])}var De={},Re={},ht={},gn=48,yn=57;function mt(t){if(t===void 0)return"_unknown";t=t.replace(/[^a-zA-Z0-9_]/g,"$");var e=t.charCodeAt(0);return e>=gn&&e<=yn?"_"+t:t}function vt(t,e){return t=mt(t),new Function("body","return function "+t+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(e)}function Nt(t,e){var r=vt(e,function(n){this.name=e,this.message=n;var l=new Error(n).stack;l!==void 0&&(this.stack=this.toString()+`
`+l.replace(/^Error(:[^\n]*)?\n/,""))});return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},r}var dr=void 0;function gt(t){throw new dr(t)}function Ee(t,e,r){t.forEach(function(u){ht[u]=e});function n(u){var d=r(u);d.length!==t.length&&gt("Mismatched type converter count");for(var m=0;m<t.length;++m)me(t[m],d[m])}var l=new Array(e.length),c=[],_=0;e.forEach((u,d)=>{Re.hasOwnProperty(u)?l[d]=Re[u]:(c.push(u),De.hasOwnProperty(u)||(De[u]=[]),De[u].push(()=>{l[d]=Re[u],++_,_===c.length&&n(l)}))}),c.length===0&&n(l)}function wn(t){var e=pt[t];delete pt[t];var r=e.rawConstructor,n=e.rawDestructor,l=e.fields,c=l.map(_=>_.getterReturnType).concat(l.map(_=>_.setterArgumentType));Ee([t],c,_=>{var u={};return l.forEach((d,m)=>{var A=d.fieldName,E=_[m],C=d.getter,V=d.getterContext,W=_[m+l.length],z=d.setter,Q=d.setterContext;u[A]={read:R=>E.fromWireType(C(V,R)),write:(R,p)=>{var w=[];z(Q,R,W.toWireType(w,p)),$t(w)}}}),[{name:e.name,fromWireType:function(d){var m={};for(var A in u)m[A]=u[A].read(d);return n(d),m},toWireType:function(d,m){for(var A in u)if(!(A in m))throw new TypeError('Missing field:  "'+A+'"');var E=r();for(A in u)u[A].write(E,m[A]);return d!==null&&d.push(n,E),E},argPackAdvance:8,readValueFromPointer:Je,destructorFunction:n}]})}function bn(t,e,r,n,l){}function yt(t){switch(t){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+t)}}function Tn(){for(var t=new Array(256),e=0;e<256;++e)t[e]=String.fromCharCode(e);pr=t}var pr=void 0;function K(t){for(var e="",r=t;H[r>>>0];)e+=pr[H[r++>>>0]];return e}var Ie=void 0;function I(t){throw new Ie(t)}function me(t,e,r={}){if(!("argPackAdvance"in e))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=e.name;if(t||I('type "'+n+'" must have a positive integer typeid pointer'),Re.hasOwnProperty(t)){if(r.ignoreDuplicateRegistrations)return;I("Cannot register type '"+n+"' twice")}if(Re[t]=e,delete ht[t],De.hasOwnProperty(t)){var l=De[t];delete De[t],l.forEach(c=>c())}}function Cn(t,e,r,n,l){var c=yt(r);e=K(e),me(t,{name:e,fromWireType:function(_){return!!_},toWireType:function(_,u){return u?n:l},argPackAdvance:8,readValueFromPointer:function(_){var u;if(r===1)u=q;else if(r===2)u=G;else if(r===4)u=T;else throw new TypeError("Unknown boolean type size: "+e);return this.fromWireType(u[_>>>c])},destructorFunction:null})}function En(t){if(!(this instanceof Ae)||!(t instanceof Ae))return!1;for(var e=this.$$.ptrType.registeredClass,r=this.$$.ptr,n=t.$$.ptrType.registeredClass,l=t.$$.ptr;e.baseClass;)r=e.upcast(r),e=e.baseClass;for(;n.baseClass;)l=n.upcast(l),n=n.baseClass;return e===n&&r===l}function An(t){return{count:t.count,deleteScheduled:t.deleteScheduled,preservePointerOnDelete:t.preservePointerOnDelete,ptr:t.ptr,ptrType:t.ptrType,smartPtr:t.smartPtr,smartPtrType:t.smartPtrType}}function Dt(t){function e(r){return r.$$.ptrType.registeredClass.name}I(e(t)+" instance already deleted")}var It=!1;function hr(t){}function On(t){t.smartPtr?t.smartPtrType.rawDestructor(t.smartPtr):t.ptrType.registeredClass.rawDestructor(t.ptr)}function mr(t){t.count.value-=1;var e=t.count.value===0;e&&On(t)}function vr(t,e,r){if(e===r)return t;if(r.baseClass===void 0)return null;var n=vr(t,e,r.baseClass);return n===null?null:r.downcast(n)}var gr={};function Pn(){return Object.keys(Ke).length}function Sn(){var t=[];for(var e in Ke)Ke.hasOwnProperty(e)&&t.push(Ke[e]);return t}var Xe=[];function Vt(){for(;Xe.length;){var t=Xe.pop();t.$$.deleteScheduled=!1,t.delete()}}var Ze=void 0;function Rn(t){Ze=t,Xe.length&&Ze&&Ze(Vt)}function xn(){i.getInheritedInstanceCount=Pn,i.getLiveInheritedInstances=Sn,i.flushPendingDeletes=Vt,i.setDelayFunction=Rn}var Ke={};function kn(t,e){for(e===void 0&&I("ptr should not be undefined");t.baseClass;)e=t.upcast(e),t=t.baseClass;return e}function jn(t,e){return e=kn(t,e),Ke[e]}function wt(t,e){(!e.ptrType||!e.ptr)&&gt("makeClassHandle requires ptr and ptrType");var r=!!e.smartPtrType,n=!!e.smartPtr;return r!==n&&gt("Both smartPtrType and smartPtr must be specified"),e.count={value:1},Qe(Object.create(t,{$$:{value:e}}))}function Fn(t){var e=this.getPointee(t);if(!e)return this.destructor(t),null;var r=jn(this.registeredClass,e);if(r!==void 0){if(r.$$.count.value===0)return r.$$.ptr=e,r.$$.smartPtr=t,r.clone();var n=r.clone();return this.destructor(t),n}function l(){return this.isSmartPointer?wt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:e,smartPtrType:this,smartPtr:t}):wt(this.registeredClass.instancePrototype,{ptrType:this,ptr:t})}var c=this.registeredClass.getActualType(e),_=gr[c];if(!_)return l.call(this);var u;this.isConst?u=_.constPointerType:u=_.pointerType;var d=vr(e,this.registeredClass,u.registeredClass);return d===null?l.call(this):this.isSmartPointer?wt(u.registeredClass.instancePrototype,{ptrType:u,ptr:d,smartPtrType:this,smartPtr:t}):wt(u.registeredClass.instancePrototype,{ptrType:u,ptr:d})}function Qe(t){return typeof FinalizationRegistry>"u"?(Qe=e=>e,t):(It=new FinalizationRegistry(e=>{mr(e.$$)}),Qe=e=>{var r=e.$$,n=!!r.smartPtr;if(n){var l={$$:r};It.register(e,l,e)}return e},hr=e=>It.unregister(e),Qe(t))}function $n(){if(this.$$.ptr||Dt(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var t=Qe(Object.create(Object.getPrototypeOf(this),{$$:{value:An(this.$$)}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t}function Nn(){this.$$.ptr||Dt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&I("Object already scheduled for deletion"),hr(this),mr(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Dn(){return!this.$$.ptr}function In(){return this.$$.ptr||Dt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&I("Object already scheduled for deletion"),Xe.push(this),Xe.length===1&&Ze&&Ze(Vt),this.$$.deleteScheduled=!0,this}function Vn(){Ae.prototype.isAliasOf=En,Ae.prototype.clone=$n,Ae.prototype.delete=Nn,Ae.prototype.isDeleted=Dn,Ae.prototype.deleteLater=In}function Ae(){}function yr(t,e,r){if(t[e].overloadTable===void 0){var n=t[e];t[e]=function(){return t[e].overloadTable.hasOwnProperty(arguments.length)||I("Function '"+r+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+t[e].overloadTable+")!"),t[e].overloadTable[arguments.length].apply(this,arguments)},t[e].overloadTable=[],t[e].overloadTable[n.argCount]=n}}function Mt(t,e,r){i.hasOwnProperty(t)?((r===void 0||i[t].overloadTable!==void 0&&i[t].overloadTable[r]!==void 0)&&I("Cannot register public name '"+t+"' twice"),yr(i,t,t),i.hasOwnProperty(r)&&I("Cannot register multiple overloads of a function with the same number of arguments ("+r+")!"),i[t].overloadTable[r]=e):(i[t]=e,r!==void 0&&(i[t].numArguments=r))}function Mn(t,e,r,n,l,c,_,u){this.name=t,this.constructor=e,this.instancePrototype=r,this.rawDestructor=n,this.baseClass=l,this.getActualType=c,this.upcast=_,this.downcast=u,this.pureVirtualFunctions=[]}function Ut(t,e,r){for(;e!==r;)e.upcast||I("Expected null or instance of "+r.name+", got an instance of "+e.name),t=e.upcast(t),e=e.baseClass;return t}function Un(t,e){if(e===null)return this.isReference&&I("null is not a valid "+this.name),0;e.$$||I('Cannot pass "'+Yt(e)+'" as a '+this.name),e.$$.ptr||I("Cannot pass deleted object as a pointer of type "+this.name);var r=e.$$.ptrType.registeredClass,n=Ut(e.$$.ptr,r,this.registeredClass);return n}function Hn(t,e){var r;if(e===null)return this.isReference&&I("null is not a valid "+this.name),this.isSmartPointer?(r=this.rawConstructor(),t!==null&&t.push(this.rawDestructor,r),r):0;e.$$||I('Cannot pass "'+Yt(e)+'" as a '+this.name),e.$$.ptr||I("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&e.$$.ptrType.isConst&&I("Cannot convert argument of type "+(e.$$.smartPtrType?e.$$.smartPtrType.name:e.$$.ptrType.name)+" to parameter type "+this.name);var n=e.$$.ptrType.registeredClass;if(r=Ut(e.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(e.$$.smartPtr===void 0&&I("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:e.$$.smartPtrType===this?r=e.$$.smartPtr:I("Cannot convert argument of type "+(e.$$.smartPtrType?e.$$.smartPtrType.name:e.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:r=e.$$.smartPtr;break;case 2:if(e.$$.smartPtrType===this)r=e.$$.smartPtr;else{var l=e.clone();r=this.rawShare(r,U.toHandle(function(){l.delete()})),t!==null&&t.push(this.rawDestructor,r)}break;default:I("Unsupporting sharing policy")}return r}function Wn(t,e){if(e===null)return this.isReference&&I("null is not a valid "+this.name),0;e.$$||I('Cannot pass "'+Yt(e)+'" as a '+this.name),e.$$.ptr||I("Cannot pass deleted object as a pointer of type "+this.name),e.$$.ptrType.isConst&&I("Cannot convert argument of type "+e.$$.ptrType.name+" to parameter type "+this.name);var r=e.$$.ptrType.registeredClass,n=Ut(e.$$.ptr,r,this.registeredClass);return n}function Ln(t){return this.rawGetPointee&&(t=this.rawGetPointee(t)),t}function zn(t){this.rawDestructor&&this.rawDestructor(t)}function Yn(t){t!==null&&t.delete()}function Gn(){ve.prototype.getPointee=Ln,ve.prototype.destructor=zn,ve.prototype.argPackAdvance=8,ve.prototype.readValueFromPointer=Je,ve.prototype.deleteObject=Yn,ve.prototype.fromWireType=Fn}function ve(t,e,r,n,l,c,_,u,d,m,A){this.name=t,this.registeredClass=e,this.isReference=r,this.isConst=n,this.isSmartPointer=l,this.pointeeType=c,this.sharingPolicy=_,this.rawGetPointee=u,this.rawConstructor=d,this.rawShare=m,this.rawDestructor=A,!l&&e.baseClass===void 0?n?(this.toWireType=Un,this.destructorFunction=null):(this.toWireType=Wn,this.destructorFunction=null):this.toWireType=Hn}function wr(t,e,r){i.hasOwnProperty(t)||gt("Replacing nonexistant public symbol"),i[t].overloadTable!==void 0&&r!==void 0?i[t].overloadTable[r]=e:(i[t]=e,i[t].argCount=r)}function Bn(t,e,r){var n=i["dynCall_"+t];return r&&r.length?n.apply(null,[e].concat(r)):n.call(null,e)}function qn(t,e,r){return t.includes("j")?Bn(t,e,r):dt(e).apply(null,r)}function Jn(t,e){var r=[];return function(){return r.length=0,Object.assign(r,arguments),qn(t,e,r)}}function ne(t,e){t=K(t);function r(){return t.includes("j")?Jn(t,e):dt(e)}var n=r();return typeof n!="function"&&I("unknown function pointer with signature "+t+": "+e),n}var br=void 0;function Tr(t){var e=jr(t),r=K(e);return be(e),r}function bt(t,e){var r=[],n={};function l(c){if(!n[c]&&!Re[c]){if(ht[c]){ht[c].forEach(l);return}r.push(c),n[c]=!0}}throw e.forEach(l),new br(t+": "+r.map(Tr).join([", "]))}function Xn(t,e,r,n,l,c,_,u,d,m,A,E,C){A=K(A),c=ne(l,c),u&&(u=ne(_,u)),m&&(m=ne(d,m)),C=ne(E,C);var V=mt(A);Mt(V,function(){bt("Cannot construct "+A+" due to unbound types",[n])}),Ee([t,e,r],n?[n]:[],function(W){W=W[0];var z,Q;n?(z=W.registeredClass,Q=z.instancePrototype):Q=Ae.prototype;var R=vt(V,function(){if(Object.getPrototypeOf(this)!==p)throw new Ie("Use 'new' to construct "+A);if(w.constructor_body===void 0)throw new Ie(A+" has no accessible constructor");var xe=w.constructor_body[arguments.length];if(xe===void 0)throw new Ie("Tried to invoke ctor of "+A+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(w.constructor_body).toString()+") parameters instead!");return xe.apply(this,arguments)}),p=Object.create(Q,{constructor:{value:R}});R.prototype=p;var w=new Mn(A,R,p,C,z,c,u,m),ee=new ve(A,w,!0,!1,!1),B=new ve(A+"*",w,!1,!1,!1),ge=new ve(A+" const*",w,!1,!0,!1);return gr[t]={pointerType:B,constPointerType:ge},wr(V,R),[ee,B,ge]})}function Ht(t,e){for(var r=[],n=0;n<t;n++)r.push(T[(e>>2)+n>>>0]);return r}function Cr(t,e){if(!(t instanceof Function))throw new TypeError("new_ called with constructor type "+typeof t+" which is not a function");var r=vt(t.name||"unknownFunctionName",function(){});r.prototype=t.prototype;var n=new r,l=t.apply(n,e);return l instanceof Object?l:n}function Wt(t,e,r,n,l){var c=e.length;c<2&&I("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var _=e[1]!==null&&r!==null,u=!1,d=1;d<e.length;++d)if(e[d]!==null&&e[d].destructorFunction===void 0){u=!0;break}for(var m=e[0].name!=="void",A="",E="",d=0;d<c-2;++d)A+=(d!==0?", ":"")+"arg"+d,E+=(d!==0?", ":"")+"arg"+d+"Wired";var C="return function "+mt(t)+"("+A+`) {
if (arguments.length !== `+(c-2)+`) {
throwBindingError('function `+t+" called with ' + arguments.length + ' arguments, expected "+(c-2)+` args!');
}
`;u&&(C+=`var destructors = [];
`);var V=u?"destructors":"null",W=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],z=[I,n,l,$t,e[0],e[1]];_&&(C+="var thisWired = classParam.toWireType("+V+`, this);
`);for(var d=0;d<c-2;++d)C+="var arg"+d+"Wired = argType"+d+".toWireType("+V+", arg"+d+"); // "+e[d+2].name+`
`,W.push("argType"+d),z.push(e[d+2]);if(_&&(E="thisWired"+(E.length>0?", ":"")+E),C+=(m?"var rv = ":"")+"invoker(fn"+(E.length>0?", ":"")+E+`);
`,u)C+=`runDestructors(destructors);
`;else for(var d=_?1:2;d<e.length;++d){var Q=d===1?"thisWired":"arg"+(d-2)+"Wired";e[d].destructorFunction!==null&&(C+=Q+"_dtor("+Q+"); // "+e[d].name+`
`,W.push(Q+"_dtor"),z.push(e[d].destructorFunction))}m&&(C+=`var ret = retType.fromWireType(rv);
return ret;
`),C+=`}
`,W.push(C);var R=Cr(Function,W).apply(null,z);return R}function Zn(t,e,r,n,l,c){h(e>0);var _=Ht(e,r);l=ne(n,l),Ee([],[t],function(u){u=u[0];var d="constructor "+u.name;if(u.registeredClass.constructor_body===void 0&&(u.registeredClass.constructor_body=[]),u.registeredClass.constructor_body[e-1]!==void 0)throw new Ie("Cannot register multiple constructors with identical number of parameters ("+(e-1)+") for class '"+u.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return u.registeredClass.constructor_body[e-1]=()=>{bt("Cannot construct "+u.name+" due to unbound types",_)},Ee([],_,function(m){return m.splice(1,0,null),u.registeredClass.constructor_body[e-1]=Wt(d,m,null,l,c),[]}),[]})}function Kn(t,e,r,n,l,c,_,u){var d=Ht(r,n);e=K(e),c=ne(l,c),Ee([],[t],function(m){m=m[0];var A=m.name+"."+e;e.startsWith("@@")&&(e=Symbol[e.substring(2)]),u&&m.registeredClass.pureVirtualFunctions.push(e);function E(){bt("Cannot call "+A+" due to unbound types",d)}var C=m.registeredClass.instancePrototype,V=C[e];return V===void 0||V.overloadTable===void 0&&V.className!==m.name&&V.argCount===r-2?(E.argCount=r-2,E.className=m.name,C[e]=E):(yr(C,e,A),C[e].overloadTable[r-2]=E),Ee([],d,function(W){var z=Wt(A,W,m,c,_);return C[e].overloadTable===void 0?(z.argCount=r-2,C[e]=z):C[e].overloadTable[r-2]=z,[]}),[]})}var Lt=[],_e=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function zt(t){t>4&&--_e[t].refcount===0&&(_e[t]=void 0,Lt.push(t))}function Qn(){for(var t=0,e=5;e<_e.length;++e)_e[e]!==void 0&&++t;return t}function ei(){for(var t=5;t<_e.length;++t)if(_e[t]!==void 0)return _e[t];return null}function ti(){i.count_emval_handles=Qn,i.get_first_emval=ei}var U={toValue:t=>(t||I("Cannot use deleted val. handle = "+t),_e[t].value),toHandle:t=>{switch(t){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var e=Lt.length?Lt.pop():_e.length;return _e[e]={refcount:1,value:t},e}}}};function ri(t,e){e=K(e),me(t,{name:e,fromWireType:function(r){var n=U.toValue(r);return zt(r),n},toWireType:function(r,n){return U.toHandle(n)},argPackAdvance:8,readValueFromPointer:Je,destructorFunction:null})}function ni(t,e,r){switch(e){case 0:return function(n){var l=r?q:H;return this.fromWireType(l[n>>>0])};case 1:return function(n){var l=r?G:re;return this.fromWireType(l[n>>>1])};case 2:return function(n){var l=r?T:F;return this.fromWireType(l[n>>>2])};default:throw new TypeError("Unknown integer type: "+t)}}function ii(t,e,r,n){var l=yt(r);e=K(e);function c(){}c.values={},me(t,{name:e,constructor:c,fromWireType:function(_){return this.constructor.values[_]},toWireType:function(_,u){return u.value},argPackAdvance:8,readValueFromPointer:ni(e,l,n),destructorFunction:null}),Mt(e,c)}function et(t,e){var r=Re[t];return r===void 0&&I(e+" has unknown type "+Tr(t)),r}function si(t,e,r){var n=et(t,"enum");e=K(e);var l=n.constructor,c=Object.create(n.constructor.prototype,{value:{value:r},constructor:{value:vt(n.name+"_"+e,function(){})}});l.values[r]=c,l[e]=c}function Yt(t){if(t===null)return"null";var e=typeof t;return e==="object"||e==="array"||e==="function"?t.toString():""+t}function oi(t,e){switch(e){case 2:return function(r){return this.fromWireType(ie[r>>>2])};case 3:return function(r){return this.fromWireType($e[r>>>3])};default:throw new TypeError("Unknown float type: "+t)}}function ai(t,e,r){var n=yt(r);e=K(e),me(t,{name:e,fromWireType:function(l){return l},toWireType:function(l,c){return c},argPackAdvance:8,readValueFromPointer:oi(e,n),destructorFunction:null})}function li(t,e,r,n,l,c){var _=Ht(e,r);t=K(t),l=ne(n,l),Mt(t,function(){bt("Cannot call "+t+" due to unbound types",_)},e-1),Ee([],_,function(u){var d=[u[0],null].concat(u.slice(1));return wr(t,Wt(t,d,null,l,c),e-1),[]})}function ui(t,e,r){switch(e){case 0:return r?function(l){return q[l>>>0]}:function(l){return H[l>>>0]};case 1:return r?function(l){return G[l>>>1]}:function(l){return re[l>>>1]};case 2:return r?function(l){return T[l>>>2]}:function(l){return F[l>>>2]};default:throw new TypeError("Unknown integer type: "+t)}}function ci(t,e,r,n,l){e=K(e),l===-1&&(l=4294967295);var c=yt(r),_=E=>E;if(n===0){var u=32-8*r;_=E=>E<<u>>>u}var d=e.includes("unsigned"),m=(E,C)=>{},A;d?A=function(E,C){return m(C,this.name),C>>>0}:A=function(E,C){return m(C,this.name),C},me(t,{name:e,fromWireType:_,toWireType:A,argPackAdvance:8,readValueFromPointer:ui(e,c,n!==0),destructorFunction:null})}function fi(t,e,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],l=n[e];function c(_){_=_>>2;var u=F,d=u[_>>>0],m=u[_+1>>>0];return new l(te,m,d)}r=K(r),me(t,{name:r,fromWireType:c,argPackAdvance:8,readValueFromPointer:c},{ignoreDuplicateRegistrations:!0})}function _i(t,e,r,n,l,c,_,u,d,m,A,E){r=K(r),c=ne(l,c),u=ne(_,u),m=ne(d,m),E=ne(A,E),Ee([t],[e],function(C){C=C[0];var V=new ve(r,C.registeredClass,!1,!1,!0,C,n,c,u,m,E);return[V]})}function di(t,e){e=K(e);var r=e==="std::string";me(t,{name:e,fromWireType:function(n){var l=F[n>>>2],c;if(r)for(var _=n+4,u=0;u<=l;++u){var d=n+4+u;if(u==l||H[d>>>0]==0){var m=d-_,A=P(_,m);c===void 0?c=A:(c+=String.fromCharCode(0),c+=A),_=d+1}}else{for(var E=new Array(l),u=0;u<l;++u)E[u]=String.fromCharCode(H[n+4+u>>>0]);c=E.join("")}return be(n),c},toWireType:function(n,l){l instanceof ArrayBuffer&&(l=new Uint8Array(l));var c,_=typeof l=="string";_||l instanceof Uint8Array||l instanceof Uint8ClampedArray||l instanceof Int8Array||I("Cannot pass non-string to std::string"),r&&_?c=()=>S(l):c=()=>l.length;var u=c(),d=ot(4+u+1);if(d>>>=0,F[d>>>2]=u,r&&_)M(l,d+4,u+1);else if(_)for(var m=0;m<u;++m){var A=l.charCodeAt(m);A>255&&(be(d),I("String has UTF-16 code units that do not fit in 8 bits")),H[d+4+m>>>0]=A}else for(var m=0;m<u;++m)H[d+4+m>>>0]=l[m];return n!==null&&n.push(be,d),d},argPackAdvance:8,readValueFromPointer:Je,destructorFunction:function(n){be(n)}})}function pi(t,e,r){r=K(r);var n,l,c,_,u;e===2?(n=X,l=Z,_=ce,c=()=>re,u=1):e===4&&(n=fe,l=he,_=Fe,c=()=>F,u=2),me(t,{name:r,fromWireType:function(d){for(var m=F[d>>>2],A=c(),E,C=d+4,V=0;V<=m;++V){var W=d+4+V*e;if(V==m||A[W>>>u]==0){var z=W-C,Q=n(C,z);E===void 0?E=Q:(E+=String.fromCharCode(0),E+=Q),C=W+e}}return be(d),E},toWireType:function(d,m){typeof m!="string"&&I("Cannot pass non-string to C++ string type "+r);var A=_(m),E=ot(4+A+e);return E>>>=0,F[E>>>2]=A>>u,l(m,E+4,A+e),d!==null&&d.push(be,E),E},argPackAdvance:8,readValueFromPointer:Je,destructorFunction:function(d){be(d)}})}function hi(t,e,r,n,l,c){pt[t]={name:K(e),rawConstructor:ne(r,n),rawDestructor:ne(l,c),fields:[]}}function mi(t,e,r,n,l,c,_,u,d,m){pt[t].fields.push({fieldName:K(e),getterReturnType:r,getter:ne(n,l),getterContext:c,setterArgumentType:_,setter:ne(u,d),setterContext:m})}function vi(t,e){e=K(e),me(t,{isVoid:!0,name:e,argPackAdvance:0,fromWireType:function(){},toWireType:function(r,n){}})}function gi(){return Date.now()}var yi=!0;function wi(){return yi}function bi(t,e,r){t=U.toValue(t),e=et(e,"emval::as");var n=[],l=U.toHandle(n);return T[r>>>2]=l,e.toWireType(n,t)}function Er(t,e){for(var r=new Array(t),n=0;n<t;++n)r[n]=et(F[e+n*ft>>>2],"parameter "+n);return r}function Ti(t,e,r,n){t=U.toValue(t);for(var l=Er(e,r),c=new Array(e),_=0;_<e;++_){var u=l[_];c[_]=u.readValueFromPointer(n),n+=u.argPackAdvance}var d=t.apply(void 0,c);return U.toHandle(d)}function Ci(t){var e=[];return T[t>>>2]=U.toHandle(e),e}var Ei={};function tt(t){var e=Ei[t];return e===void 0?K(t):e}var Tt=[];function Ai(t,e,r,n,l){return t=Tt[t],e=U.toValue(e),r=tt(r),t(e,r,Ci(n),l)}function Oi(t,e,r,n){t=Tt[t],e=U.toValue(e),r=tt(r),t(e,r,null,n)}function Ar(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Pi(t){return t===0?U.toHandle(Ar()):(t=tt(t),U.toHandle(Ar()[t]))}function Si(t){var e=Tt.length;return Tt.push(t),e}var Or=[];function Ri(t,e){var r=Er(t,e),n=r[0],l=n.name+"_$"+r.slice(1).map(function(W){return W.name}).join("_")+"$",c=Or[l];if(c!==void 0)return c;for(var _=["retType"],u=[n],d="",m=0;m<t-1;++m)d+=(m!==0?", ":"")+"arg"+m,_.push("argType"+m),u.push(r[1+m]);for(var A=mt("methodCaller_"+l),E="return function "+A+`(handle, name, destructors, args) {
`,C=0,m=0;m<t-1;++m)E+="    var arg"+m+" = argType"+m+".readValueFromPointer(args"+(C?"+"+C:"")+`);
`,C+=r[m+1].argPackAdvance;E+="    var rv = handle[name]("+d+`);
`;for(var m=0;m<t-1;++m)r[m+1].deleteObject&&(E+="    argType"+m+".deleteObject(arg"+m+`);
`);n.isVoid||(E+=`    return retType.toWireType(destructors, rv);
`),E+=`};
`,_.push(E);var V=Cr(Function,_).apply(null,u);return c=Si(V),Or[l]=c,c}function xi(t){return t=tt(t),U.toHandle(i[t])}function ki(t,e){return t=U.toValue(t),e=U.toValue(e),U.toHandle(t[e])}function ji(t){t>4&&(_e[t].refcount+=1)}function Fi(t,e){return t=U.toValue(t),e=U.toValue(e),t instanceof e}function $i(t){for(var e="",r=0;r<t;++r)e+=(r!==0?", ":"")+"arg"+r;for(var n="return function emval_allocator_"+t+`(constructor, argTypes, args) {
`,r=0;r<t;++r)n+="var argType"+r+" = requireRegisteredType(Module['HEAP32'][(argTypes >>> 2) + "+r+'], "parameter '+r+`");
var arg`+r+" = argType"+r+`.readValueFromPointer(args);
args += argType`+r+`['argPackAdvance'];
`;return n+="var obj = new constructor("+e+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle",n)(et,i,U.toHandle)}var Pr={};function Ni(t,e,r,n){t=U.toValue(t);var l=Pr[e];return l||(l=$i(e),Pr[e]=l),l(t,r,n)}function Di(){return U.toHandle([])}function Ii(t){return U.toHandle(tt(t))}function Vi(){return U.toHandle({})}function Mi(t){var e=U.toValue(t);$t(e),zt(t)}function Ui(t,e,r){t=U.toValue(t),e=U.toValue(e),r=U.toValue(r),t[e]=r}function Hi(t,e){t=et(t,"_emval_take_value");var r=t.readValueFromPointer(e);return U.toHandle(r)}function Wi(t){return t=U.toValue(t),U.toHandle(typeof t)}function Li(t,e){var r=new Date(T[t>>>2]*1e3);T[e>>>2]=r.getSeconds(),T[e+4>>>2]=r.getMinutes(),T[e+8>>>2]=r.getHours(),T[e+12>>>2]=r.getDate(),T[e+16>>>2]=r.getMonth(),T[e+20>>>2]=r.getFullYear()-1900,T[e+24>>>2]=r.getDay();var n=new Date(r.getFullYear(),0,1),l=(r.getTime()-n.getTime())/(1e3*60*60*24)|0;T[e+28>>>2]=l,T[e+36>>>2]=-(r.getTimezoneOffset()*60);var c=new Date(r.getFullYear(),6,1).getTimezoneOffset(),_=n.getTimezoneOffset(),u=(c!=_&&r.getTimezoneOffset()==Math.min(_,c))|0;T[e+32>>>2]=u}function zi(t,e,r,n,l,c){return-52}function Yi(t,e,r,n,l,c){t>>>=0}function Gi(t,e,r){var n=new Date().getFullYear(),l=new Date(n,0,1),c=new Date(n,6,1),_=l.getTimezoneOffset(),u=c.getTimezoneOffset(),d=Math.max(_,u);T[t>>>2]=d*60,T[e>>>2]=Number(_!=u);function m(W){var z=W.toTimeString().match(/\(([A-Za-z ]+)\)$/);return z?z[1]:"GMT"}var A=m(l),E=m(c),C=Ye(A),V=Ye(E);u<_?(F[r>>>2]=C,F[r+4>>>2]=V):(F[r>>>2]=V,F[r+4>>>2]=C)}function Gt(t,e,r){Gt.called||(Gt.called=!0,Gi(t,e,r))}function Bi(){Ne("")}var Bt=[];function qi(t,e){Bt.length=0;var r;for(e>>=2;r=H[t++>>>0];)e+=r!=105&e,Bt.push(r==105?T[e>>>0]:$e[e++>>>1]),++e;return Bt}function Ji(t,e,r){var n=qi(e,r);return nn[t].apply(null,n)}function Sr(){return 4294901760}function Xi(){return Sr()}var Rr;Rr=()=>performance.now();function Zi(t,e,r){H.copyWithin(t>>>0,e>>>0,e+r>>>0)}function Ki(t){try{return s.grow(t-te.byteLength+65535>>>16),Ge(s.buffer),1}catch{}}function Qi(t){var e=H.length;t=t>>>0;var r=Sr();if(t>r)return!1;let n=(d,m)=>d+(m-d%m)%m;for(var l=1;l<=4;l*=2){var c=e*(1+.2/l);c=Math.min(c,t+100663296);var _=Math.min(r,n(Math.max(t,c),65536)),u=Ki(_);if(u)return!0}return!1}var qt={};function es(){return Y||"./this.program"}function rt(){if(!rt.strings){var t=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:t,_:es()};for(var r in qt)qt[r]===void 0?delete e[r]:e[r]=qt[r];var n=[];for(var r in e)n.push(r+"="+e[r]);rt.strings=n}return rt.strings}function ts(t,e){var r=0;return rt().forEach(function(n,l){var c=e+r;F[t+l*4>>>2]=c,oe(n,c),r+=n.length+1}),0}function rs(t,e){var r=rt();F[t>>>2]=r.length;var n=0;return r.forEach(function(l){n+=l.length+1}),F[e>>>2]=n,0}function ns(t){return 52}function is(t,e,r,n){return 52}function ss(t,e,r,n,l){return 70}var os=[null,[],[]];function as(t,e){var r=os[t];e===0||e===10?((t===1?we:D)(O(r,0)),r.length=0):r.push(e)}function ls(t,e,r,n){for(var l=0,c=0;c<r;c++){var _=F[e>>>2],u=F[e+4>>>2];e+=8;for(var d=0;d<u;d++)as(t,H[_+d>>>0]);l+=u}return F[n>>>2]=l,0}function us(t){xt(t)}function Ve(t){return t%4===0&&(t%100!==0||t%400===0)}function Jt(t,e){for(var r=0,n=0;n<=e;r+=t[n++]);return r}var nt=[31,29,31,30,31,30,31,31,30,31,30,31],it=[31,28,31,30,31,30,31,31,30,31,30,31];function st(t,e){for(var r=new Date(t.getTime());e>0;){var n=Ve(r.getFullYear()),l=r.getMonth(),c=(n?nt:it)[l];if(e>c-r.getDate())e-=c-r.getDate()+1,r.setDate(1),l<11?r.setMonth(l+1):(r.setMonth(0),r.setFullYear(r.getFullYear()+1));else return r.setDate(r.getDate()+e),r}return r}function xr(t,e,r,n){var l=T[n+40>>>2],c={tm_sec:T[n>>>2],tm_min:T[n+4>>>2],tm_hour:T[n+8>>>2],tm_mday:T[n+12>>>2],tm_mon:T[n+16>>>2],tm_year:T[n+20>>>2],tm_wday:T[n+24>>>2],tm_yday:T[n+28>>>2],tm_isdst:T[n+32>>>2],tm_gmtoff:T[n+36>>>2],tm_zone:l?P(l):""},_=P(r),u={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var d in u)_=_.replace(new RegExp(d,"g"),u[d]);var m=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],A=["January","February","March","April","May","June","July","August","September","October","November","December"];function E(p,w,ee){for(var B=typeof p=="number"?p.toString():p||"";B.length<w;)B=ee[0]+B;return B}function C(p,w){return E(p,w,"0")}function V(p,w){function ee(ge){return ge<0?-1:ge>0?1:0}var B;return(B=ee(p.getFullYear()-w.getFullYear()))===0&&(B=ee(p.getMonth()-w.getMonth()))===0&&(B=ee(p.getDate()-w.getDate())),B}function W(p){switch(p.getDay()){case 0:return new Date(p.getFullYear()-1,11,29);case 1:return p;case 2:return new Date(p.getFullYear(),0,3);case 3:return new Date(p.getFullYear(),0,2);case 4:return new Date(p.getFullYear(),0,1);case 5:return new Date(p.getFullYear()-1,11,31);case 6:return new Date(p.getFullYear()-1,11,30)}}function z(p){var w=st(new Date(p.tm_year+1900,0,1),p.tm_yday),ee=new Date(w.getFullYear(),0,4),B=new Date(w.getFullYear()+1,0,4),ge=W(ee),xe=W(B);return V(ge,w)<=0?V(xe,w)<=0?w.getFullYear()+1:w.getFullYear():w.getFullYear()-1}var Q={"%a":function(p){return m[p.tm_wday].substring(0,3)},"%A":function(p){return m[p.tm_wday]},"%b":function(p){return A[p.tm_mon].substring(0,3)},"%B":function(p){return A[p.tm_mon]},"%C":function(p){var w=p.tm_year+1900;return C(w/100|0,2)},"%d":function(p){return C(p.tm_mday,2)},"%e":function(p){return E(p.tm_mday,2," ")},"%g":function(p){return z(p).toString().substring(2)},"%G":function(p){return z(p)},"%H":function(p){return C(p.tm_hour,2)},"%I":function(p){var w=p.tm_hour;return w==0?w=12:w>12&&(w-=12),C(w,2)},"%j":function(p){return C(p.tm_mday+Jt(Ve(p.tm_year+1900)?nt:it,p.tm_mon-1),3)},"%m":function(p){return C(p.tm_mon+1,2)},"%M":function(p){return C(p.tm_min,2)},"%n":function(){return`
`},"%p":function(p){return p.tm_hour>=0&&p.tm_hour<12?"AM":"PM"},"%S":function(p){return C(p.tm_sec,2)},"%t":function(){return"	"},"%u":function(p){return p.tm_wday||7},"%U":function(p){var w=p.tm_yday+7-p.tm_wday;return C(Math.floor(w/7),2)},"%V":function(p){var w=Math.floor((p.tm_yday+7-(p.tm_wday+6)%7)/7);if((p.tm_wday+371-p.tm_yday-2)%7<=2&&w++,w){if(w==53){var B=(p.tm_wday+371-p.tm_yday)%7;B!=4&&(B!=3||!Ve(p.tm_year))&&(w=1)}}else{w=52;var ee=(p.tm_wday+7-p.tm_yday-1)%7;(ee==4||ee==5&&Ve(p.tm_year%400-1))&&w++}return C(w,2)},"%w":function(p){return p.tm_wday},"%W":function(p){var w=p.tm_yday+7-(p.tm_wday+6)%7;return C(Math.floor(w/7),2)},"%y":function(p){return(p.tm_year+1900).toString().substring(2)},"%Y":function(p){return p.tm_year+1900},"%z":function(p){var w=p.tm_gmtoff,ee=w>=0;return w=Math.abs(w)/60,w=w/60*100+w%60,(ee?"+":"-")+String("0000"+w).slice(-4)},"%Z":function(p){return p.tm_zone},"%%":function(){return"%"}};_=_.replace(/%%/g,"\0\0");for(var d in Q)_.includes(d)&&(_=_.replace(new RegExp(d,"g"),Q[d](c)));_=_.replace(/\0\0/g,"%");var R=kr(_,!1);return R.length>e?0:(kt(R,t),R.length-1)}function cs(t,e,r,n){return xr(t,e,r,n)}function ue(t){return parseInt(t)}function fs(t,e,r){for(var n=P(e),l="\\!@#$^&*()+=-[]/{}|:<>?,.",c=0,_=l.length;c<_;++c)n=n.replace(new RegExp("\\"+l[c],"g"),"\\"+l[c]);var u={"%A":"%a","%B":"%b","%c":"%a %b %d %H:%M:%S %Y","%D":"%m\\/%d\\/%y","%e":"%d","%F":"%Y-%m-%d","%h":"%b","%R":"%H\\:%M","%r":"%I\\:%M\\:%S\\s%p","%T":"%H\\:%M\\:%S","%x":"%m\\/%d\\/(?:%y|%Y)","%X":"%H\\:%M\\:%S"};for(var d in u)n=n.replace(d,u[d]);var m={"%a":"(?:Sun(?:day)?)|(?:Mon(?:day)?)|(?:Tue(?:sday)?)|(?:Wed(?:nesday)?)|(?:Thu(?:rsday)?)|(?:Fri(?:day)?)|(?:Sat(?:urday)?)","%b":"(?:Jan(?:uary)?)|(?:Feb(?:ruary)?)|(?:Mar(?:ch)?)|(?:Apr(?:il)?)|May|(?:Jun(?:e)?)|(?:Jul(?:y)?)|(?:Aug(?:ust)?)|(?:Sep(?:tember)?)|(?:Oct(?:ober)?)|(?:Nov(?:ember)?)|(?:Dec(?:ember)?)","%C":"\\d\\d","%d":"0[1-9]|[1-9](?!\\d)|1\\d|2\\d|30|31","%H":"\\d(?!\\d)|[0,1]\\d|20|21|22|23","%I":"\\d(?!\\d)|0\\d|10|11|12","%j":"00[1-9]|0?[1-9](?!\\d)|0?[1-9]\\d(?!\\d)|[1,2]\\d\\d|3[0-6]\\d","%m":"0[1-9]|[1-9](?!\\d)|10|11|12","%M":"0\\d|\\d(?!\\d)|[1-5]\\d","%n":"\\s","%p":"AM|am|PM|pm|A\\.M\\.|a\\.m\\.|P\\.M\\.|p\\.m\\.","%S":"0\\d|\\d(?!\\d)|[1-5]\\d|60","%U":"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53","%W":"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53","%w":"[0-6]","%y":"\\d\\d","%Y":"\\d\\d\\d\\d","%%":"%","%t":"\\s"},A={JAN:0,FEB:1,MAR:2,APR:3,MAY:4,JUN:5,JUL:6,AUG:7,SEP:8,OCT:9,NOV:10,DEC:11},E={SUN:0,MON:1,TUE:2,WED:3,THU:4,FRI:5,SAT:6},C={MON:0,TUE:1,WED:2,THU:3,FRI:4,SAT:5,SUN:6};for(var V in m)n=n.replace(V,"("+V+m[V]+")");for(var W=[],c=n.indexOf("%");c>=0;c=n.indexOf("%"))W.push(n[c+1]),n=n.replace(new RegExp("\\%"+n[c+1],"g"),"");var z=new RegExp("^"+n,"i").exec(P(t));function Q(){function Oe(Pe,Zt,Dr){return typeof Pe!="number"||isNaN(Pe)?Zt:Pe>=Zt?Pe<=Dr?Pe:Dr:Zt}return{year:Oe(T[r+20>>>2]+1900,1970,9999),month:Oe(T[r+16>>>2],0,11),day:Oe(T[r+12>>>2],1,31),hour:Oe(T[r+8>>>2],0,23),min:Oe(T[r+4>>>2],0,59),sec:Oe(T[r>>>2],0,59)}}if(z){var R=Q(),p,w=Oe=>{var Pe=W.indexOf(Oe);if(Pe>=0)return z[Pe+1]};if((p=w("S"))&&(R.sec=ue(p)),(p=w("M"))&&(R.min=ue(p)),p=w("H"))R.hour=ue(p);else if(p=w("I")){var ee=ue(p);(p=w("p"))&&(ee+=p.toUpperCase()[0]==="P"?12:0),R.hour=ee}if(p=w("Y"))R.year=ue(p);else if(p=w("y")){var B=ue(p);(p=w("C"))?B+=ue(p)*100:B+=B<69?2e3:1900,R.year=B}if((p=w("m"))?R.month=ue(p)-1:(p=w("b"))&&(R.month=A[p.substring(0,3).toUpperCase()]||0),p=w("d"))R.day=ue(p);else if(p=w("j"))for(var ge=ue(p),xe=Ve(R.year),Et=0;Et<12;++Et){var $r=Jt(xe?nt:it,Et-1);ge<=$r+(xe?nt:it)[Et]&&(R.day=ge-$r)}else if(p=w("a")){var Nr=p.substring(0,3).toUpperCase();if(p=w("U")){var at=E[Nr],lt=ue(p),Te=new Date(R.year,0,1),Ce;Te.getDay()===0?Ce=st(Te,at+7*(lt-1)):Ce=st(Te,7-Te.getDay()+at+7*(lt-1)),R.day=Ce.getDate(),R.month=Ce.getMonth()}else if(p=w("W")){var at=C[Nr],lt=ue(p),Te=new Date(R.year,0,1),Ce;Te.getDay()===1?Ce=st(Te,at+7*(lt-1)):Ce=st(Te,7-Te.getDay()+1+at+7*(lt-1)),R.day=Ce.getDate(),R.month=Ce.getMonth()}}var ye=new Date(R.year,R.month,R.day,R.hour,R.min,R.sec,0);return T[r>>>2]=ye.getSeconds(),T[r+4>>>2]=ye.getMinutes(),T[r+8>>>2]=ye.getHours(),T[r+12>>>2]=ye.getDate(),T[r+16>>>2]=ye.getMonth(),T[r+20>>>2]=ye.getFullYear()-1900,T[r+24>>>2]=ye.getDay(),T[r+28>>>2]=Jt(Ve(ye.getFullYear())?nt:it,ye.getMonth()-1)+ye.getDate()-1,T[r+32>>>2]=0,t+kr(z[0]).length-1}return 0}dr=i.InternalError=Nt(Error,"InternalError"),Tn(),Ie=i.BindingError=Nt(Error,"BindingError"),Vn(),xn(),Gn(),br=i.UnboundTypeError=Nt(Error,"UnboundTypeError"),ti();function kr(t,e,r){var n=r>0?r:S(t)+1,l=new Array(n),c=b(t,l,0,l.length);return e&&(l.length=c),l}var _s={a:sn,i:on,h:cn,M:fn,T:_n,X:dn,da:pn,N:hn,aa:mn,V:vn,F:wn,U:bn,la:Cn,q:Xn,v:Zn,d:Kn,ka:ri,Q:ii,u:si,O:ai,p:li,B:ci,x:fi,y:_i,P:di,J:pi,G:hi,A:mi,ma:vi,ga:gi,fa:wi,l:bi,pa:Ti,o:Ai,r:Oi,b:zt,s:Pi,k:Ri,w:xi,m:ki,e:ji,R:Fi,t:Ni,H:Di,n:Ii,L:Vi,g:Mi,C:Ui,j:Hi,D:Wi,ha:Li,Y:zi,Z:Yi,ia:Gt,f:Bi,c:Ji,W:Xi,ea:Rr,ja:Zi,I:Qi,_:ts,$:rs,E:ns,ca:is,S:ss,ba:ls,K:us,oa:xr,z:cs,na:fs},Bs=rn(),ds=i.___wasm_call_ctors=function(){return(ds=i.___wasm_call_ctors=i.asm.ra).apply(null,arguments)},ot=i._malloc=function(){return(ot=i._malloc=i.asm.sa).apply(null,arguments)},be=i._free=function(){return(be=i._free=i.asm.ta).apply(null,arguments)},jr=i.___getTypeName=function(){return(jr=i.___getTypeName=i.asm.va).apply(null,arguments)},ps=i.___embind_register_native_and_builtin_types=function(){return(ps=i.___embind_register_native_and_builtin_types=i.asm.wa).apply(null,arguments)},Fr=i.___cxa_is_pointer_type=function(){return(Fr=i.___cxa_is_pointer_type=i.asm.xa).apply(null,arguments)},hs=i.dynCall_ji=function(){return(hs=i.dynCall_ji=i.asm.ya).apply(null,arguments)},ms=i.dynCall_viij=function(){return(ms=i.dynCall_viij=i.asm.za).apply(null,arguments)},vs=i.dynCall_viiij=function(){return(vs=i.dynCall_viiij=i.asm.Aa).apply(null,arguments)},gs=i.dynCall_viiijj=function(){return(gs=i.dynCall_viiijj=i.asm.Ba).apply(null,arguments)},ys=i.dynCall_viji=function(){return(ys=i.dynCall_viji=i.asm.Ca).apply(null,arguments)},ws=i.dynCall_viiji=function(){return(ws=i.dynCall_viiji=i.asm.Da).apply(null,arguments)},bs=i.dynCall_viijji=function(){return(bs=i.dynCall_viijji=i.asm.Ea).apply(null,arguments)},Ts=i.dynCall_viijj=function(){return(Ts=i.dynCall_viijj=i.asm.Fa).apply(null,arguments)},Cs=i.dynCall_viijij=function(){return(Cs=i.dynCall_viijij=i.asm.Ga).apply(null,arguments)},Es=i.dynCall_viiiijii=function(){return(Es=i.dynCall_viiiijii=i.asm.Ha).apply(null,arguments)},As=i.dynCall_vijjji=function(){return(As=i.dynCall_vijjji=i.asm.Ia).apply(null,arguments)},Os=i.dynCall_jiji=function(){return(Os=i.dynCall_jiji=i.asm.Ja).apply(null,arguments)},Ps=i.dynCall_viijii=function(){return(Ps=i.dynCall_viijii=i.asm.Ka).apply(null,arguments)},Ss=i.dynCall_iiiiij=function(){return(Ss=i.dynCall_iiiiij=i.asm.La).apply(null,arguments)},Rs=i.dynCall_iiiiijj=function(){return(Rs=i.dynCall_iiiiijj=i.asm.Ma).apply(null,arguments)},xs=i.dynCall_iiiiiijj=function(){return(xs=i.dynCall_iiiiiijj=i.asm.Na).apply(null,arguments)},Ct;Be=function t(){Ct||Xt(),Ct||(Be=t)};function Xt(t){if(t=t||k,Se>0||(Gr(),Se>0))return;function e(){Ct||(Ct=!0,i.calledRun=!0,!a&&(Br(),y(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),qr()))}i.setStatus?(i.setStatus("Running..."),setTimeout(function(){setTimeout(function(){i.setStatus("")},1),e()},1)):e()}if(i.run=Xt,i.preInit)for(typeof i.preInit=="function"&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return Xt(),o.ready}})(),Vr=Fs;var At={};js(At,{COLUMN_SEPARATOR_STRING:()=>de,CONFIG_ALIASES:()=>Me,CONFIG_VALID_KEYS:()=>Qt,DATA_TYPES:()=>$s,FILTER_OPERATORS:()=>$,SORT_ORDERS:()=>Ds,SORT_ORDER_IDS:()=>Is,TYPE_AGGREGATES:()=>Vs,TYPE_FILTERS:()=>Hs});var $s={integer:"integer",float:"float",string:"string",boolean:"boolean",date:"date",datetime:"datetime",object:"object"},Me={row_pivot:"group_by","row-pivot":"group_by","row-pivots":"group_by",col_pivot:"split_by",col_pivots:"split_by",column_pivot:"split_by","column-pivot":"split_by","column-pivots":"split_by",filters:"filter",sorts:"sort"},Qt=["viewport","group_by","split_by","aggregates","columns","filter","sort","computed_columns","expressions","group_by_depth","split_by_depth","filter_op"],Mr=["any","avg","abs sum","count","distinct count","dominant","first by index","last by index","last minus first","last","high","join","low","high minus low","max","mean","median","min","pct sum parent","pct sum grand total","stddev","sum","sum abs","sum not null","unique","var"],Kt=["any","count","distinct count","distinct leaf","dominant","first by index","join","last by index","last","unique"],Ns=["any","count","distinct count","distinct leaf","dominant","first by index","last by index","last","unique"],Ds=["none","asc","desc","col asc","col desc","asc abs","desc abs","col asc abs","col desc abs"],Is=[2,0,1,0,1,3,4,3,4],Vs={string:Kt,float:Mr,integer:Mr,boolean:Ns,datetime:Kt,date:Kt},$={lessThan:"<",greaterThan:">",equals:"==",lessThanOrEquals:"<=",greaterThanOrEquals:">=",doesNotEqual:"!=",isNull:"is null",isNotNull:"is not null",isIn:"in",isNotIn:"not in",contains:"contains",bitwiseAnd:"&",bitwiseOr:"|",and:"and",or:"or",beginsWith:"begins with",endsWith:"ends with"},Ms=[$.bitwiseAnd,$.bitwiseOr,$.equals,$.doesNotEqual,$.or,$.and,$.isNull,$.isNotNull],Ur=[$.lessThan,$.greaterThan,$.equals,$.lessThanOrEquals,$.greaterThanOrEquals,$.doesNotEqual,$.isNull,$.isNotNull],Us=[$.equals,$.contains,$.doesNotEqual,$.isIn,$.isNotIn,$.beginsWith,$.endsWith,$.isNull,$.isNotNull],Hr=[$.lessThan,$.greaterThan,$.equals,$.lessThanOrEquals,$.greaterThanOrEquals,$.doesNotEqual,$.isNull,$.isNotNull],de="|",Hs={string:Us,float:Ur,integer:Ur,boolean:Ms,datetime:Hr,date:Hr};var er={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short",timeStyle:"medium"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short"},null_value:-1}}};function ke(v){let o={};if(Wr().types[v]&&Object.assign(o,Wr().types[v]),o.type){let i=ke(o.type);return Object.assign(i,o),i}else return o}function tr(v){return v&&typeof v=="object"&&!Array.isArray(v)}function Ot(v,...o){if(!o.length)return v;let i=o.shift();if(tr(v)&&tr(i))for(let y in i)tr(i[y])?(v[y]||Object.assign(v,{[y]:{}}),Ot(v[y],i[y])):Object.assign(v,{[y]:i[y]});return Ot(v,...o)}function Lr(v){globalThis.__PERSPECTIVE_CONFIG__&&console.warn("Config already initialized!"),globalThis.__PERSPECTIVE_CONFIG__=Ot(er,v)}function Wr(){return globalThis.__PERSPECTIVE_CONFIG__||(globalThis.__PERSPECTIVE_CONFIG__=Ot(er,globalThis.__TEMPLATE_CONFIG__||{})),globalThis.__PERSPECTIVE_CONFIG__}function Pt(v){if(v>=1&&v<=8)return"integer";if(v===19)return"string";if(v===10||v===9)return"float";if(v===11)return"boolean";if(v===12)return"datetime";if(v===13)return"date";console.warn(`Unknown type for value ${v} with JS type ${typeof v}`)}function rr(v){let o=v;do for(let i of Object.getOwnPropertyNames(o)){let y=v[i];i!=="constructor"&&typeof y=="function"&&(v[i]=y.bind(v))}while(o=o!==Object&&Object.getPrototypeOf(o))}String.prototype.includes||(String.prototype.includes=function(v,o){return typeof o!="number"&&(o=0),o+v.length>this.length?!1:this.indexOf(v,o)!==-1});Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(v,o){if(this==null)throw new TypeError('"this" is null or not defined');var i=Object(this),y=i.length>>>0;if(y===0)return!1;var N=o|0,x=Math.max(N>=0?N:y-Math.abs(N),0);function k(Y,J){return Y===J||typeof Y=="number"&&typeof J=="number"&&isNaN(Y)&&isNaN(J)}for(;x<y;){if(k(i[x],v))return!0;x++}return!1}});var St=class{constructor(){this.data_formats={row:0,column:1,schema:2},this.format=void 0,this.data=void 0,this.names=void 0,this.types=void 0,this.row_count=void 0}is_format(o){if(Array.isArray(o))return this.data_formats.row;if(Array.isArray(o[Object.keys(o)[0]]))return this.data_formats.column;if(typeof o[Object.keys(o)[0]]=="string"||typeof o[Object.keys(o)[0]]=="function")return this.data_formats.schema;throw`Could not determine data format for ${JSON.stringify(o)}, with JS typeof ${typeof o}`}count_rows(o){return this.format===this.data_formats.row?o.length:this.format===this.data_formats.column?o[Object.keys(o)[0]].length:0}get_format(){return this.format}get(o,i){let y;if(this.format===this.data_formats.row){let N=this.data[i];N.hasOwnProperty(o)&&(y=N[o])}else if(this.format===this.data_formats.column)this.data.hasOwnProperty(o)&&(y=this.data[o][i]);else if(this.format===this.data_formats.schema)y=void 0;else throw`Could not get() from dataset - ${this.data} is poorly formatted.`;return y}marshal(o,i,y){let N=this.names[o],x=Ws(this.get(N,i));if(x===null)return null;if(!(typeof x>"u")){switch(Pt(y.value)){case"float":case"integer":{x=Number(x);break}case"boolean":{typeof x=="string"?x.toLowerCase()==="true"?x=!0:x=!1:x=!!x;break}case"datetime":case"date":break;default:x+=""}return x}}clean(){this.names=void 0,this.types=void 0}init(o){this.data=o,this.format=this.is_format(this.data),this.row_count=this.count_rows(this.data);let i={};if(this.format===this.data_formats.row)o.length>0?this.names=Object.keys(o[0]):this.clean.names=[];else if(this.format===this.data_formats.column)this.names=Object.keys(o);else if(this.format===this.data_formats.schema){this.names=Object.keys(o);for(let y of this.names){let N=ke(o[y]);N.type&&(console.debug(`Converting "${o[y]}" to "${N.type}"`),i[y]=o[y],o[y]=N.type)}}else throw`Could not initialize - failed to determine format for ${o}`;return i}};function Ws(v){return v===null||v==="null"?null:v===void 0||v==="undefined"?void 0:v}var nr=function(v){let o=[];for(let i=0;i<v.size();i++){let y=v.get(i);o.push(y)}return v.delete(),o},ir=function(v){let o={},i=v.keys();for(let y=0;y<i.size();y++){let N=i.get(y);o[N]=v.get(N)}return v.delete(),i.delete(),o},Ue=function(v,o){for(let i of o)v.push_back(i);return v};function Ls(v){let o={};return typeof v!="string"?Object.getOwnPropertyNames(v).forEach(i=>{o[i]=v[i]},v):o.message=v,o}var ut=class{constructor(o){this.perspective=o,this._tables={},this._views={},this._callback_cache=new Map}init(o){o.config&&Lr(o.config),o.data=["wait_for_response"],this.post(o)}post(o){throw new Error(`Posting ${o} failed - post() not implemented!`)}process(o,i){switch(o.cmd){case"init_profile_thread":this.perspective.initialize_profile_thread();break;case"memory_usage":this.post({id:o.id,data:this.perspective.memory_usage()});break;case"init":this.init(o);break;case"table":if(typeof o.args[0]>"u")this._tables[o.name]=[];else try{let k=this._tables[o.name],Y=this.perspective.table(o.args[0],o.options);if(Y&&Y.then)Y.then(J=>{if(this._tables[o.name]=J,k)for(let pe of k)this.process(pe);this.post({id:o.id,data:o.name})}).catch(J=>this.process_error(o,J));else{if(this._tables[o.name]=Y,k)for(let J of k)this.process(J);this.post({id:o.id,data:o.name})}}catch(k){this.process_error(o,k);return}break;case"table_generate":(0,eval)(o.args)(function(k){this._tables[o.name]=k,this.post({id:o.id,data:"created!"})});break;case"table_execute":(0,eval)(o.f)(this._tables[o.name]);break;case"table_method":case"view_method":this.process_method_call(o);break;case"view":let x=this._tables[o.table_name];if(x&&Array.isArray(x))x.push(o),this._views[o.view_name]=[];else try{let k=this._views[o.view_name],Y=this._tables[o.table_name].view(o.config);if(Y&&Y.then)Y.then(J=>{if(this._views[o.view_name]=J,this._views[o.view_name].client_id=i,k)for(let pe of k)this.process(pe);this.post({id:o.id,data:o.view_name})}).catch(J=>this.process_error(o,J));else{if(this._views[o.view_name]=Y,this._views[o.view_name].client_id=i,k)for(let J of k)this.process(J);this.post({id:o.id,data:o.view_name})}}catch(k){this.process_error(o,k);return}break}}process_subscribe(o,i){try{let y;o.method.slice(0,2)==="on"?(y=N=>{let x={id:o.id,data:N};try{if(o.args&&o.args[0]&&o.method==="on_update"&&o.args[0].mode==="row"){this.post(x,[N.delta]);return}this.post(x)}catch{console.error(`Removing failed callback to \`${o.method}()\` (presumably due to failed connection)`);let Y=o.method.substring(3);i[`remove_${Y}`](y)}},o.callback_id&&this._callback_cache.set(o.callback_id,y)):o.callback_id&&(y=this._callback_cache.get(o.callback_id),this._callback_cache.delete(o.callback_id)),y?i[o.method](y,...o.args):console.error(`Callback not found for remote call "${JSON.stringify(o)}"`)}catch(y){this.process_error(o,y);return}}process_method_call(o){let i,y,N=o.view_name||o.name;if(o.cmd==="table_method"?i=this._tables[N]:i=this._views[N],!i&&o.cmd==="view_method"){this.process_error(o,{message:"View method cancelled"});return}if(i&&i.push){i.push(o);return}try{if(o.subscribe){this.process_subscribe(o,i);return}else y=i[o.method].apply(i,o.args),y instanceof Promise?y.then(x=>this.process_method_call_response(o,x)).catch(x=>this.process_error(o,x)):this.process_method_call_response(o,y)}catch(x){this.process_error(o,x);return}}process_method_call_response(o,i){o.method==="delete"&&delete this._views[o.name],o.method==="to_arrow"?this.post({id:o.id,data:i},[i]):this.post({id:o.id,data:i})}process_error(o,i){this.post({id:o.id,error:Ls(i)})}clear_views(o){for(let i of Object.keys(this._views))if(this._views[i].client_id===o){try{this._views[i].delete()}catch(y){console.error(y)}delete this._views[i]}console.debug(`GC ${Object.keys(this._views).length} views in memory`)}};var zs={initDataValue:()=>[],initRowValue:()=>({}),initColumnValue:(v,o)=>{},initColumnRowPath:(v,o,i)=>o[i]=[],setColumnValue:(v,o,i,y)=>o[i]=y,addColumnValue:(v,o,i,y)=>o[i].unshift(y),addRow:(v,o)=>v.push(o),formatData:v=>v,slice:(v,o)=>v.slice(o)},Ys={initDataValue:()=>new Object,initRowValue:()=>{},initColumnValue:(v,o)=>{v[o]=[]},setColumnValue:(v,o,i,y)=>{v[i].push(y)},addColumnValue:(v,o,i,y)=>{v[i][v[i].length-1].unshift(y)},initColumnRowPath:(v,o,i)=>{v[i]=v[i]||[],v[i].push([])},addRow:()=>{},formatData:v=>v,slice:(v,o)=>{let i={};for(let y in v)i[y]=v[y].slice(o);return i}},sr={jsonFormatter:zs,jsonTableFormatter:Ys};typeof self<"u"&&self.performance===void 0&&(self.performance={now:Date.now});var Rt=new Set;function zr(v){let o=v,i=new St,y=["zero","one","two"],N={};function x(s,a){N[a]?s.delete():(N[a]=s,setTimeout(()=>k(a)))}function k(s){let a=N[s];a&&(a._process(),Y(s))}function Y(s){N[s]?.delete(),delete N[s]}function J(){let s=performance.memory?JSON.parse(JSON.stringify(performance.memory,["totalJSHeapSize","usedJSHeapSize","jsHeapSizeLimit"])):process.memoryUsage();return s.wasmHeap=o.HEAP8.length,s}function pe(s,a,f,h,g,O,P,b,M){f||(f=""),h||(h=4294967295),a=o.make_table(a,s,h,f,g,O,P,b,M);let S=a.get_pool(),L=a.get_id();return O||g==o.t_op.OP_DELETE?x(S,L):(S._process(),S.delete()),a}function j(s,a,f,h,g){this.name=g,this._View=void 0,this.table=s,this.config=f||{},this.view_config=h||new h,this.is_unit_context=this.table.index===""&&a===0&&this.view_config.group_by.length===0&&this.view_config.split_by.length===0&&this.view_config.filter.length===0&&this.view_config.sort.length===0&&this.view_config.expressions.length===0,this.is_unit_context?this._View=o.make_view_unit(s._Table,g,de,this.view_config,null):a===0?this._View=o.make_view_zero(s._Table,g,de,this.view_config,null):a===1?this._View=o.make_view_one(s._Table,g,de,this.view_config,null):a===2&&(this._View=o.make_view_two(s._Table,g,de,this.view_config,null)),this.ctx=this._View.get_context(),this.column_only=this._View.is_column_only(),this.update_callbacks=this.table.update_callbacks,this.overridden_types=this.table.overridden_types,this._delete_callbacks=[],rr(this)}j.prototype.get_config=function(){return JSON.parse(JSON.stringify(this.config))},j.prototype.delete=function(){Y(this.table.get_id()),this._View.delete(),this.ctx.delete(),this.table.views.splice(this.table.views.indexOf(this),1),this.table=void 0;let s=0,a=0;for(;s<this.update_callbacks.length;){let f=this.update_callbacks[s];f.view!==this&&(this.update_callbacks[a++]=f),s++}this.update_callbacks.length=a,this._delete_callbacks.forEach(f=>f())},j.prototype.sides=function(){return this._View.sides()},j.prototype._num_hidden=function(){let s=0;for(let a of this.config.sort)this.config.columns.indexOf(a[0])===-1&&s++;return s};function ae(s){let a=[];for(let f=0;f<s.size();f++){let h=s.get(f);a.push(o.scalar_to_val(h,!1,!0)),h.delete()}return s.delete(),a}let He=function(s){let a=[];for(let f=0;f<s.size();f++){let h=s.get(f);a.push(ae(h))}return s.delete(),a};j.prototype.schema=function(s=!0){let a=ir(this._View.schema());if(s)for(let f of Object.keys(a)){let h=f.split(de);h=h[h.length-1],this.overridden_types[h]&&ke(this.overridden_types[h]).type===a[f]&&(a[f]=this.overridden_types[h])}return a},j.prototype.expression_schema=function(s=!0){let a=ir(this._View.expression_schema());if(s)for(let f of Object.keys(a)){let h=f.split(de);h=h[h.length-1],this.overridden_types[h]&&ke(this.overridden_types[h]).type===a[f]&&(a[f]=this.overridden_types[h])}return a},j.prototype._column_names=function(s=!1,a=0){return He(this._View.column_names(s,a)).map(f=>f.join(de))},j.prototype.column_paths=function(){return He(this._View.column_paths()).map(s=>s.join(de))},j.prototype.get_data_slice=function(s,a,f,h){if(this.is_unit_context)return o.get_data_slice_unit(this._View,s,a,f,h);{let g=this.sides(),O=y[g];return o[`get_data_slice_${O}`](this._View,s,a,f,h)}};let We=function(s){s=s||{};let a=this._View.num_columns()+(this.sides()===0?0:1),f=this._View.num_rows(),h=this._num_hidden(),g=this.sides()>0||this.column_only?1:0,O=this.config.viewport?this.config.viewport:{},P=s.start_row||(O.top?O.top:0),b=Math.min(f,s.end_row!==void 0?s.end_row:O.height?P+O.height:f),M=s.start_col||(O.left?O.left:0),S=Math.min(a,(s.end_col!==void 0?s.end_col+g:O.width?M+O.width:a)*(h+1));return s.start_row=Math.floor(P),s.end_row=Math.ceil(b),s.start_col=Math.floor(M),s.end_col=Math.ceil(S),s};j.prototype.get_min_max=function(s){if(this.is_unit_context)return o.get_min_max_unit(this._View,s);{let a=this.sides(),f=y[a];return o[`get_min_max_${f}`](this._View,s)}};let ct=function(s,a){k(this.table.get_id()),s=We.bind(this)(s);let f=s.start_row,h=s.end_row,g=s.start_col,O=s.end_col,P=this._num_hidden(),b=s.formatted,M=!!s.index,S=!!s.id,L=!!s.leaves_only,X=this.sides(),Z=X!==0&&!this.column_only,ce=y[X],fe;this.is_unit_context?fe=o.get_from_data_slice_unit:fe=o[`get_from_data_slice_${ce}`];let he=this.get_data_slice(f,h,g,O),Fe=he.get_column_names(),Ye=He(Fe).map(te=>te.join(de)),kt=this.schema(),oe=a.initDataValue();for(let te=g;te<O;te++){let q=Ye[te];a.initColumnValue(oe,q)}for(let te=f;te<h;te++){let q=Z?he.get_row_path(te):void 0;if(Z&&L&&q.size()<this.config.group_by.length){q.delete();continue}let H=a.initRowValue();S&&a.initColumnRowPath(oe,H,"__ID__");for(let G=g;G<O;G++){let re=Ye[G],T=kt[re],F=ke(T);if(G===g&&X!==0){if(!this.column_only){a.initColumnRowPath(oe,H,"__ROW_PATH__");for(let ie=0;ie<q.size();ie++){let $e=q.get(ie),Ge=o.scalar_to_val($e,!1,!1);$e.delete(),a.addColumnValue(oe,H,"__ROW_PATH__",Ge),S&&a.addColumnValue(oe,H,"__ID__",Ge)}}}else{if((G-(X>0?1:0))%(this.config.columns.length+P)>=this.config.columns.length)continue;{let ie=fe(he,te,G);b&&ie!==null&&ie!==void 0&&(T==="datetime"||T==="date")&&(ie=new Date(ie),ie=ie.toLocaleString([],F.format)),a.setColumnValue(oe,H,re,ie)}}}if(M){let G=he.get_pkeys(te,0);a.initColumnRowPath(oe,H,"__INDEX__");for(let re=0;re<G.size();re++){let T=G.get(re),F=o.scalar_to_val(T,!1,!1);T.delete(),a.addColumnValue(oe,H,"__INDEX__",F)}G.delete()}if(S&&X===0){let G=he.get_pkeys(te,0);for(let re=0;re<G.size();re++){let T=G.get(re),F=o.scalar_to_val(T,!1,!1);T.delete(),a.addColumnValue(oe,H,"__ID__",F)}G.delete()}q&&q.delete(),a.addRow(oe,H)}return he.delete(),a.formatData(oe,s.config)},Le=function(s,a,f){let h=this.num_rows(),g=a.start_row||0,O=a.end_row||h,b=this._column_names().indexOf(s);if(b===-1)return;this.sides()>0&&b++;let S,L;a.data_slice?S=a.data_slice.get_column_slice(b):(L=this.get_data_slice(g,O,b,b+1),S=L.get_slice());let X=this._View.get_column_dtype(b),Z=f(S,X,b);return S.delete(),L&&L.delete(),Z};j.prototype.to_columns=function(s){return ct.call(this,s,sr.jsonTableFormatter)},j.prototype.to_json=function(s){return ct.call(this,s,sr.jsonFormatter)},j.prototype.to_csv=function(s){k(this.table.get_id()),s=We.bind(this)(s);let a=s.start_row,f=s.end_row,h=s.start_col,g=s.end_col,O=this.sides();if(this.is_unit_context)return o.to_csv_unit(this._View,a,f,h,g);if(O===0)return o.to_csv_zero(this._View,a,f,h,g);if(O===1)return o.to_csv_one(this._View,a,f,h,g);if(O===2)return o.to_csv_two(this._View,a,f,h,g)},j.prototype.col_to_js_typed_array=function(s,a={}){k(this.table.get_id());let f=o.col_to_js_typed_array;return Le.call(this,s,a,f)},j.prototype.to_arrow=function(s={}){k(this.table.get_id()),s=We.bind(this)(s);let a=s.start_row,f=s.end_row,h=s.start_col,g=s.end_col,O=this.sides();if(this.is_unit_context)return o.to_arrow_unit(this._View,a,f,h,g);if(O===0)return o.to_arrow_zero(this._View,a,f,h,g);if(O===1)return o.to_arrow_one(this._View,a,f,h,g);if(O===2)return o.to_arrow_two(this._View,a,f,h,g)},j.prototype.num_rows=function(){return k(this.table.get_id()),this._View.num_rows()},j.prototype.num_columns=function(){let s=this._View.num_columns(),a=this._num_hidden();return s-s/(this.config.columns.length+a)*a},j.prototype.dimensions=function(){return{num_table_rows:this.table.num_rows(),num_table_columns:this.table.num_columns(),num_view_rows:this._View.num_rows(),num_view_columns:this.num_columns()}},j.prototype.get_row_expanded=function(s){return this._View.get_row_expanded(s)},j.prototype.expand=function(s){return this._View.expand(s,this.config.group_by.length)},j.prototype.collapse=function(s){return this._View.collapse(s)},j.prototype.set_depth=function(s){return this._View.set_depth(s,this.config.group_by.length)},j.prototype._get_step_delta=async function(){let s=this._View.get_step_delta(0,2147483647),a;if(s.cells.size()===0)a=this.to_json();else{let f={};for(let g=0;g<s.cells.size();g++)f[s.cells.get(g).row]=!0;f=Object.keys(f);let h=f.map(g=>this.to_json({start_row:Number.parseInt(g),end_row:Number.parseInt(g)+1}));a=[].concat.apply([],h)}return s.cells.delete(),a},j.prototype._get_row_delta=async function(){if(this.is_unit_context)return o.get_row_delta_unit(this._View);{let s=this.sides(),a=y[s];return o[`get_row_delta_${a}`](this._View)}},j.prototype.on_update=function(s,{mode:a="none"}={}){if(k(this.table.get_id()),["none","row"].indexOf(a)===-1)throw new Error(`Invalid update mode "${a}" - valid modes are "none" and "row".`);a==="row"&&(this._View._get_deltas_enabled()||this._View._set_deltas_enabled(!0)),this.update_callbacks.push({view:this,orig_callback:s,callback:async(f,h)=>{h[f]===void 0&&(h[f]={});let g={port_id:f};a==="row"&&(h[f].row_delta===void 0&&(h[f].row_delta=await this._get_row_delta()),g.delta=h[f].row_delta),s(g)}})};function ze(s,a){let f=0,h=0;for(;f<s.length;){let g=s[f];a(g,f,s)&&(s[h++]=g),f++}return s.length=h,s}j.prototype.remove_update=function(s){k(this.table.get_id());let a=this.update_callbacks.length;ze(this.update_callbacks,f=>f.orig_callback!==s),console.assert(a>this.update_callbacks.length,'"callback" does not match a registered updater')},j.prototype.on_delete=function(s){this._delete_callbacks.push(s)},j.prototype.remove_delete=function(s){let a=this._delete_callbacks.length;ze(this._delete_callbacks,f=>f!==s),console.assert(a>this._delete_callbacks.length,'"callback" does not match a registered delete callbacks')};function we(s){this.group_by=s.group_by||[],this.split_by=s.split_by||[],this.aggregates=s.aggregates||{},this.columns=s.columns,this.filter=s.filter||[],this.sort=s.sort||[],this.expressions=s.expressions||[],this.filter_op=s.filter_op||"and",this.group_by_depth=s.group_by_depth,this.split_by_depth=s.split_by_depth}we.prototype.get_group_by=function(){let s=o.make_string_vector();return Ue(s,this.group_by)},we.prototype.get_split_by=function(){let s=o.make_string_vector();return Ue(s,this.split_by)},we.prototype.get_columns=function(){let s=o.make_string_vector();return Ue(s,this.columns)},we.prototype.get_filter=function(){let s=o.make_2d_val_vector();for(let a of this.filter){let f=o.make_val_vector(),h=Ue(f,a);s.push_back(h)}return s},we.prototype.get_sort=function(){let s=o.make_2d_string_vector();for(let a of this.sort){let f=o.make_string_vector(),h=Ue(f,a);s.push_back(h)}return s},we.prototype.get_expressions=function(){let s=o.make_2d_val_vector();for(let a of this.expressions){let f=o.make_val_vector();for(let h of a)f.push_back(h);s.push_back(f)}return s};function D(s,a,f,h){this._Table=s;let g=this._Table.get_gnode();this.gnode_id=g.get_id(),g.delete();let O=this._Table.get_pool();O.set_update_delegate(this),O.delete(),this.name=Math.random()+"",this.initialized=!1,this.index=a,this.limit=f,this.update_callbacks=[],this._delete_callbacks=[],this.views=[],this.overridden_types=h,rr(this)}D.prototype.get_id=function(){return this._Table.get_id()},D.prototype.get_pool=function(){return this._Table.get_pool()},D.prototype.make_port=function(){return this._Table.make_port()},D.prototype.remove_port=function(){this._Table.remove_port()},D.prototype._update_callback=function(s){let a={};for(let f in this.update_callbacks)this.update_callbacks[f].callback(s,a)},D.prototype.get_index=function(){return this.index},D.prototype.get_limit=function(){return this.limit},D.prototype.clear=function(){k(this.get_id()),this._Table.reset_gnode(this.gnode_id)},D.prototype.replace=function(s){Y(this.get_id()),this._Table.reset_gnode(this.gnode_id),this.update(s),k(this.get_id())},D.prototype.delete=function(){if(this.views.length>0)throw`Cannot delete Table as it still has ${this.views.length} registered View(s).`;Y(this.get_id()),this._Table.unregister_gnode(this.gnode_id),this._Table.delete();for(let s of this._delete_callbacks)s()},D.prototype.on_delete=function(s){this._delete_callbacks.push(s)},D.prototype.remove_delete=function(s){let a=this._delete_callbacks.length;ze(this._delete_callbacks,f=>f!==s),console.assert(a>this._delete_callbacks.length,'"callback" does not match a registered delete callbacks')},D.prototype.size=function(){return k(this._Table.get_id()),this._Table.size()},D.prototype.num_rows=function(){return this.size()},D.prototype.num_columns=function(){let s=this._Table.get_schema(),a=s.columns(),f=a.size();return a.delete(),s.delete(),f-1},D.prototype.schema=function(s=!0){let a=this._Table.get_schema(),f=a.columns(),h=a.types(),g={};for(let O=0;O<f.size();O++){let P=f.get(O);P!=="psp_okey"&&(s&&this.overridden_types[P]?g[P]=this.overridden_types[P]:g[P]=Pt(h.get(O).value))}return a.delete(),f.delete(),h.delete(),g};function ft(s){let a=[],f={};for(let h of s){if(h.includes('""')){console.error(`Skipping expression '${h}', as it cannot reference an empty column!`);continue}let g={},O={},P=0,b,M=h.match(/^\/\/(?<alias>.+?)\n/);M?.groups?.alias&&(b=M.groups.alias.trim()),(!b||b.length==0)&&(b=h);let S=h.replace(/([a-zA-Z_]+[a-zA-Z0-9_]*)/g,Z=>Z=="true"?"True":Z=="false"?"False":Z);S=S.replace(/\"(.*?[^\\])\"/g,(Z,ce)=>{if(ce=ce.replace(/\\"/g,'"'),g[ce]===void 0){let fe=`COLUMN${P}`;g[ce]=fe,O[fe]=ce}return P++,g[ce]}),S=S.replace(/'(.*?[^\\])'/g,Z=>`intern(${Z})`);let L=(Z,ce,fe,he)=>{let Fe=Z.indexOf(fe);return`${Z.substring(0,Fe)}'${he}'${Z.substring(Fe+fe.length)}`};S=S.replace(/(bucket|match|match_all|search|indexof)\(.*?,\s*(intern\(\'(.+)\'\)).*\)/g,L),S=S.replace(/(replace_all|replace)\(.*?,\s*(intern\(\'(.*)\'\)),.*\)/g,L);let X=[b,h,S,O];if(f[b]!==void 0){let Z=f[b];a[Z]=X}else a.push(X),f[b]=a.length-1}return a}D.prototype.validate_expressions=function(s,a=!0){let f={expression_schema:{},expression_alias:{},errors:{}};if(!s||s.length===0)return f;s=ft(s);let h=o.make_2d_val_vector();for(let S of s){let L=o.make_val_vector();for(let X of S)L.push_back(X);h.push_back(L),f.expression_alias[S[0]]=S[1]}let g=o.validate_expressions(this._Table,h),O=g.get_expression_schema(),P=g.get_expression_errors(),b=O.keys();for(let S=0;S<b.size();S++){let L=b.get(S),X=O.get(L);a&&this.overridden_types[L]&&(X=this.overridden_types[L]),f.expression_schema[L]=X}let M=P.keys();for(let S=0;S<M.size();S++){let L=M.get(S),X=P.get(L);f.errors[L]=X}return M.delete(),b.delete(),P.delete(),O.delete(),g.delete(),f},D.prototype.is_valid_filter=function(s){if(s[1]===se.FILTER_OPERATORS.isNull||s[1]===se.FILTER_OPERATORS.isNotNull)return!0;let a=s[2];if(a===null)return!1;let f=this.schema();return f[s[0]]&&(f[s[0]]==="date"||f[s[0]]==="datetime")?o.is_valid_datetime(s[2]):typeof a<"u"&&a!==null},D.prototype.view=function(s={}){k(this._Table.get_id());let a={};for(let b of Object.keys(s))if(Me[b])if(!a[Me[b]])Rt.has(b)||(console.warn(`Deprecated: "${b}" config parameter, please use "${Me[b]}" instead`),Rt.add(b)),a[Me[b]]=s[b];else throw new Error(`Duplicate configuration parameter "${b}"`);else if(b==="aggregate"){Rt.has("aggregate")||(console.warn('Deprecated: "aggregate" config parameter has been replaced by "aggregates" and "columns"'),Rt.add("aggregate")),a.aggregates={},a.columns=[];for(let M of s.aggregate)a.aggregates[M.column]=M.op,a.columns.push(M.column)}else if(Qt.indexOf(b)>-1)a[b]=s[b];else throw new Error(`Unrecognized config parameter "${b}"`);a.group_by=a.group_by||[],a.split_by=a.split_by||[],a.aggregates=a.aggregates||{},a.filter=a.filter||[],a.sort=a.sort||[],a.expressions=a.expressions||[];let f=this.schema();if(a.expressions.length>0&&(a.expressions=ft(a.expressions)),a.columns===void 0&&(a.columns=this.columns(),a.expressions.length>0))for(let b of a.expressions)a.columns.push(b[0]);if(a.filter.length>0)for(let b of a.filter){let M=f[b[0]];b[1]!==se.FILTER_OPERATORS.isNull&&b[1]!==se.FILTER_OPERATORS.isNotNull&&(M==="date"||M==="datetime")&&(b[2]=new Date(b[2]))}let h=Math.random()+"",g;a.group_by.length>0||a.split_by.length>0?a.split_by&&a.split_by.length>0?g=2:g=1:g=0;let O=new we(a),P=new j(this,g,a,O,h);return this.views.push(P),P};let je;function xt(){if(je===void 0){let s=0,a=performance.now();setTimeout(function f(){let h=performance.now();console.log(`${(1e3*s/(h-a)).toFixed(2)} msgs/sec`),s=0,a=h,setTimeout(f,5e3)},5e3),je=function(h){s+=h},console.log("Profiling initialized")}}D.prototype.query_columns=function(s,a){let f=this.view(s),h=f.to_columns(a);return f.delete(),h},D.prototype.update=function(s,a){a=a||{},a.port_id=a.port_id||0;let f,h=this.columns(),g=this._Table.get_schema(),O=g.types(),P=!1,b=!1;if(f=i,s instanceof ArrayBuffer?(f=new Uint8Array(s),P=!0):typeof s=="string"?(s[0]===","&&(s="_"+s),b=!0,P=!0,f=s):(i.init(s),i.names=h.concat(i.names.filter(M=>M==="__INDEX__")),i.types=nr(O).slice(0,h.length),je&&je(i.row_count)),!P){if(f.row_count===0){console.warn("table.update called with no data - ignoring");return}i.names.indexOf("__INDEX__")!=-1&&(!!this.index?i.types.push(i.types[i.names.indexOf(this.index)]):i.types.push(o.t_dtype.DTYPE_INT32))}try{let M=o.t_op.OP_INSERT;pe(f,this._Table,this.index,this.limit,M,!0,P,b,a.port_id).delete(),this.initialized=!0}catch(M){console.error(`Update failed: ${M}`)}finally{g.delete()}},D.prototype.remove=function(s,a){if(!this.index){console.error("Cannot call `remove()` on a Table without a user-specified index.");return}a=a||{},a.port_id=a.port_id||0;let f,h=this.columns(),g=this._Table.get_schema(),O=g.types(),P=!1;s=s.map(b=>({[this.index]:b})),s instanceof ArrayBuffer?(f=new Uint8Array(s),P=!0):(i.init(s),i.names=[this.index],i.types=[nr(O)[h.indexOf(this.index)]],f=i);try{let b=o.t_op.OP_DELETE;pe(f,this._Table,this.index,this.limit,b,!1,P,!1,a.port_id).delete(),this.initialized=!0}catch(b){console.error("Remove failed",b)}finally{g.delete()}},D.prototype.columns=function(){let s=this._Table.get_schema(),a=s.columns(),f=[];for(let h=0;h<a.size();h++){let g=a.get(h);g!=="psp_okey"&&f.push(g)}return s.delete(),a.delete(),f},D.prototype.execute=function(s){s(this)};let se={__module__:o,Server:ut,worker:function(){return this},initialize_profile_thread:xt,memory_usage:J,table:function(s,a){a=a||{},a.index=a.index||null,a.limit=a.limit||null;let f,h=!1,g={},O=!1;if(s instanceof ArrayBuffer||typeof Buffer<"u"&&s instanceof Buffer?(f=new Uint8Array(s),h=!0):typeof s=="string"?(s[0]===","&&(s="_"+s),O=!0,h=!0,f=s):(i.clean(),g=i.init(s),f=i),a.index&&a.limit)throw`Cannot specify both index '${a.index}' and limit '${a.limit}'.`;let P;try{let b=o.t_op.OP_INSERT;return P=pe(f,void 0,a.index,a.limit,b,!1,h,O,0),new D(P,a.index,a.limit,g)}catch(b){throw P&&P.delete(),console.error(`Table initialization failed: ${b}`),b}}};for(let s of Object.keys(At))se[s]=At[s];class or extends ut{constructor(a){super(a),self.addEventListener("message",f=>this.process(f.data),!1)}post(a,f){self.postMessage(a,f)}init(a){if(typeof WebAssembly>"u")throw new Error("WebAssembly not supported");o({wasmBinary:a.buffer,wasmJSMethod:"native-wasm",locateFile:f=>f}).then(f=>{o=f,o.init(),super.init(a)})}}return typeof self<"u"&&self.addEventListener&&new or(se),se}var vo=globalThis.perspective=zr(Vr);})();
//# sourceMappingURL=perspective.worker.js.map
